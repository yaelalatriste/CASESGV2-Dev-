@model CedulasEvaluacion.Entities.Models.CedulaLimpieza
@{
    ViewData["Title"] = "Cédula del Servicio de Limpieza en Áreas Comunes y Oficinas con Folio: " + Model.Folio;
}

<div class="container-fluid" id="limpieza">
    <a href="#" type='button' id="btn_facturas" class='btn-sm btn-facturas float-right mr-2 mb-3' data-toggle="tooltip" title="Ver/Agregar Facturas" data-placement="top"><i class="fal fa-file-invoice"></i></a>
    @if (@Model.facturas.Count != 0)
    {
        <a href="/documents/actaLimpieza/@Model.Id" class='btn-sm btn-primary float-right mr-2 mb-3' data-toggle="tooltip" title="Generar Acta ER" data-placement="top">
            <i class="fal fa-calendar-alt"></i>
        </a>
    }
    <a href="/limpieza/index" type='button' class='btn-sm btn-warning float-right mr-2 mb-3' data-toggle="tooltip" title="Regresar al Listado de Cédulas de Limpieza" data-placement="top"><i class="fal fa-arrow-left"></i></a>
    <div class="row col-lg-12 mt-2 mb-3">
        <table class="table">
            <tr>
                <td data-toggle="tooltip" title="Folio de evaluación asignado por el sistema" data-placement="top" style="font-family: Tahoma; font-size: 13.5px; letter-spacing: 0.8px;"><strong>Folio: </strong> @Model.Folio</td>
                <td data-toggle="tooltip" title="Año de evaluación del servicio" data-placement="top"><strong>Año: </strong>@Model.Anio</td>
                <td data-toggle="tooltip" title="Mes evaluado" data-placement="top"><strong>Mes: </strong>@Model.Mes</td>
                <td data-toggle="tooltip" title="Administración/Inmueble evaluado" data-placement="top"><strong>Inmueble: </strong>@Model.inmuebles.Nombre</td>
                <td data-toggle="tooltip" title="Estatus de la cédula del servicio de Limpieza" data-placement="top"><strong>Estatus: </strong>@Model.Estatus</td>
            </tr>
            <tr>
                <td id="total_facturas" data-toggle="tooltip" title='Cantidad de facturas asignadas a el mes de "@Model.Mes" del inmueble "@Model.inmuebles.Nombre"' data-placement="top">
                    <strong>Facturas asignadas: </strong> @Model.facturas.Count
                </td>
                <td id="monto_facturas" data-toggle="tooltip" title="Monto total de las facturas capturadas en este folio" data-placement="top">
                    <strong>Monto Total IVA Incluido: </strong>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.TotalMontoFactura)
                </td>
                <td colspan="3"></td>
            </tr>
        </table>
    </div>
    <div class="card">
        <div class="card-header bg-joke text-white">
            <h5 class="mt-2">Evaluación de la cédula</h5>
        </div>
        <div class="card-body">
            <div class="row ">
                <div class="col-lg-12">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#pregunta_1" role="tab" aria-controls="home" aria-selected="true">Pregunta 1</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#pregunta_2" role="tab" aria-controls="profile" aria-selected="false">Pregunta 2</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#pregunta_3" role="tab" aria-controls="contact" aria-selected="false">Pregunta 3</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#pregunta_4" role="tab" aria-controls="contact" aria-selected="false">Pregunta 4</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#pregunta_5" role="tab" aria-controls="contact" aria-selected="false">Pregunta 5</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#pregunta_6" role="tab" aria-controls="contact" aria-selected="false">Pregunta 6</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#pregunta_7" role="tab" aria-controls="contact" aria-selected="false">Pregunta 7</a>
                        </li>
                        @if (!(@User.Claims.ElementAt(2).Value).Contains("Evaluador")) {
                            <li class="nav-item" role="presentation">
                               <a class="nav-link" id="contact-tab" data-toggle="tab" href="#pregunta_8" role="tab" aria-controls="contact" aria-selected="false">Capacitación del Personal</a>
                            </li>
                        }
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#entregables" role="tab" aria-controls="contact" aria-selected="false">Entregables</a>
                        </li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        @* Pregunta 1 *@
                        <div class="tab-pane fade mt-2 ml-3 show active" id="pregunta_1" role="tabpanel" aria-labelledby="home-tab">
                            <p class="text-black h5">1. ¿Cúando se estableció el cierre de mes?</p>
                            <div class="form-group">
                                <label for="fechaCierre">Fecha de Cierre</label>
                                <input type="date" name="pregunta1" id="detalle1" class="form-control col-lg-4 pregunta1">
                            </div>
                        </div>
                        @* Fin de la Pregunta 1 *@
                        @* Pregunta 2 *@
                        <div class="tab-pane fade mt-2 ml-3" id="pregunta_2" role="tabpanel" aria-labelledby="profile-tab">
                            <p class="text-black h5">2. ¿El personal de limpieza cumplió con las actividades contempladas en el programa de operación?</p>
                            <div class="icheck-success d-inline">
                                <input type="radio" name="pregunta2" value="true" id="radioSuccess3" class="pregunta2">
                                <label for="radioSuccess3">Si</label>
                            </div>
                            <div class="icheck-success d-inline ml-3">
                                <input type="radio" name="pregunta2" value="false" id="radioSuccess4" class="pregunta2">
                                <label for="radioSuccess4">No</label>
                            </div>
                            <div class="row col-lg-12 mt-3" id="incidencias_pr2">
                                <button type='button' class='btn btn-primary mr-2' id="btn_addInci" data-pregunta="2">Capturar Incidencia</button>
                                <button type='button' class='btn btn-primary' id="consulta_incidencias">Consultar Incidencias</button>
                            </div>
                        </div>
                        @* Fin de la Pregunta 2 *@
                        @* Pregunta 3 *@
                        <div class="tab-pane fade mt-2 ml-3" id="pregunta_3" role="tabpanel" aria-labelledby="contact-tab">
                            <p class="text-black h5">3. ¿El personal del servicio de limpieza portó uniforme e identificación en todo momento?</p>
                            <div class="icheck-success d-inline">
                                <input type="radio" name="pregunta3" value="true" id="radioSuccess5" class="pregunta3">
                                <label for="radioSuccess5">Si</label>
                            </div>
                            <div class="icheck-success d-inline ml-3">
                                <input type="radio" name="pregunta3" value="false" id="radioSuccess6" class="pregunta3">
                                <label for="radioSuccess6">No</label>
                            </div>
                        </div>
                        @* Fin de la Pregunta 3 *@
                        @* Pregunta 4 *@
                        <div class="tab-pane fade mt-2 ml-3" id="pregunta_4" role="tabpanel" aria-labelledby="contact-tab">
                            <p class="text-black h5">4. ¿Hubo disponibilidad de equipo y maquinaria para la operación del servicio en el periodo?</p>
                            <div class="icheck-success d-inline">
                                <input type="radio" name="pregunta4" value="true" id="radioSuccess7" class="pregunta4">
                                <label for="radioSuccess7">Si</label>
                            </div>
                            <div class="icheck-success d-inline ml-3">
                                <input type="radio" name="pregunta4" value="false" id="radioSuccess8" class="pregunta4">
                                <label for="radioSuccess8">No</label>
                            </div>
                            <div class="row col-lg-12 mt-3" id="incidencias_pr4">
                                <button type='button' class='btn btn-primary mr-2' id="btn_inciEquipo" data-pregunta="4">Capturar Incidencia</button>
                                <button type='button' class='btn btn-primary' id="btn_showInciEquipo">Consultar Insidencias</button>
                            </div>
                        </div>
                        @* Fin de la Pregunta 4 *@
                        @* Pregunta 5 *@
                        <div class="tab-pane fade mt-2 ml-3" id="pregunta_5" role="tabpanel" aria-labelledby="contact-tab">
                            <p class="text-black h5">5  . ¿Hubo inasistencias del personal de limpieza en el periodo?</p>
                            <div class="icheck-success d-inline">
                                <input type="radio" name="pregunta5" value="true" id="radioSuccess9" class="pregunta5">
                                <label for="radioSuccess9">Si</label>
                            </div>
                            <div class="icheck-success d-inline ml-3">
                                <input type="radio" name="pregunta5" value="false" id="radioSuccess10" class="pregunta5">
                                <label for="radioSuccess10">No</label>
                            </div>
                            <div class="form-row col-lg-12 mt-2">
                                <div class="form-group mt-2 col-md-6" id="evidencia_inasistencias">
                                    <label for="fechaCierre">Cantidad de Insistencias: </label>
                                    <br />
                                    <input type="number" name="inasistencias" id="detalle5" class="form-control col-lg-6 float-left">
                                </div>
                            </div>
                        </div>
                        @* Fin de la Pregunta 5 *@
                        @* Pregunta 6 *@
                        <div class="tab-pane fade mt-2 ml-3" id="pregunta_6" role="tabpanel" aria-labelledby="contact-tab">
                            <p class="text-black h5">6. ¿Fué entregado el comprobante de pago y las constancias de inscripción al IMSS (SUA) correspondientes al mes anterior?</p>
                            <div class="icheck-success d-inline">
                                <input type="radio" name="pregunta6" value="true" id="radioSuccess11" class="pregunta6">
                                <label for="radioSuccess11">Si</label>
                            </div>
                            <div class="icheck-success d-inline ml-3">
                                <input type="radio" name="pregunta6" value="false" id="radioSuccess12" class="pregunta6">
                                <label for="radioSuccess12">No</label>
                            </div>
                            <div class="form-row col-lg-12 mt-2" id="campos">
                                <div class="form-row">
                                    <div class="col col-lg-4">
                                        <label for="fechaCierre">Fecha de Entrega del SUA</label><br />
                                        <input type="date" name="fechaSua" id="detalle6" class="form-control float-left">
                                    </div>
                                    <div class="col-lg-5">
                                        <label for="mesCorres">Corresponde al Mes:</label><br />
                                        <select id="mes_correspondiente" class="form-control float-right"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row col-lg-12 mt-2" id="comentariosSua">
                                <div class="form-group mt-2 col-md-6">
                                    <label for="fechaCierre">Comentarios:</label><br>
                                    <textarea name="fechaSua" id="comentarios_sua" class="form-control col-lg-12 float-left" maxlength="256"></textarea>
                                </div>
                            </div>
                        </div>
                        @* Fin de la Pregunta 6 *@
                        @* Pregunta 7 *@
                        <div class="tab-pane fade mt-2 ml-3" id="pregunta_7" role="tabpanel" aria-labelledby="contact-tab">
                            <p class="text-black h5">7. ¿Se entregó el Acta Entrega-Recepción de los servicios mensual?</p>
                            <div class="icheck-success d-inline">
                                <input type="radio" name="pregunta7" value="true" id="radioSuccess13" class="pregunta7">
                                <label for="radioSuccess13">Si</label>
                            </div>
                            <div class="icheck-success d-inline ml-3">
                                <input type="radio" name="pregunta7" value="false" id="radioSuccess14" class="pregunta7">
                                <label for="radioSuccess14">No</label>
                            </div>
                            <div class="form-row col-lg-12 mt-2">
                                <div class="form-group mt-2 col-md-6" id="evidencia_acta">
                                    <label for="fechaActa">Fecha de Entrega</label><br>
                                    <input type="date" id="detalle7" class="form-control col-lg-6 float-left">
                                </div>
                            </div>
                            <div class="form-row col-lg-12 mt-2" id="comentariosActa">
                                <div class="form-group mt-2 col-md-6">
                                    <label for="fechaCierre">Comentarios:</label><br>
                                    <textarea id="comentarios_acta" class="form-control col-lg-12 float-left" maxlength="256"></textarea>
                                </div>
                            </div>
                        </div>
                        @* Fin de la Pregunta 7 *@
                        @* Pregunta 8 *@
                        <div class="tab-pane fade mt-2 ml-3" id="pregunta_8" role="tabpanel" aria-labelledby="home-tab">
                            <p class="text-black h5 mb-3">1.- ¿El prestador de servicios demostró que el personal cuenta con la capacitación para cumplir debídamente con el Servicio de Limpieza?</p>
                            <div class="icheck-success d-inline">
                                <input type="radio" name="pregunta8" value="true" id="radioSuccess15" class="pregunta8">
                                <label for="radioSuccess15">Si</label>
                            </div>
                            <div class="icheck-success d-inline ml-3">
                                <input type="radio" name="pregunta8" value="false" id="radioSuccess16" class="pregunta8">
                                <label for="radioSuccess16">No</label>
                            </div>
                        </div>
                        @* Fin de la Pregunta 8 *@
                        @* Entregables *@
                        <div class="tab-pane fade mt-2 ml-3" id="entregables" role="tabpanel" aria-labelledby="contact-tab">
                            <div class="col-lg-12 mt-3">
                                <h3>Adjuntar Entregables</h3>
                                Adjuntar la Factura, Validación del SAT, Acta Entrega-Recepción y según sea el caso adjuntar Nota(s) de Crédito con su Validación del SAT.
                                <a href="#" type='button' class='btn-sm btn-success mr-2 float-right btn_addFile'><i class="fas fa-plus"></i></a>
                            </div>
                            <div class="row col-lg-12 mt-3">
                                <table class="table" id="tblEntregables">
                                    <thead>
                                        <tr>
                                            <th>Entregable</th>
                                            <th>Archivo</th>
                                            <th>Fecha de Carga</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tEntregables"></tbody>
                                </table>
                            </div>
                        </div>
                        @* Fin de Entregables *@
                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer">
            <div class=" col-lg-12">
                @if (!(@User.Claims.ElementAt(2).Value).Contains("Evaluador"))
                {
                    <button type="button" class="btn btn-joke float-right ml-3 revisar_cedula" data-toggle="tooltip" title='Continuar a la Revisión de la Cédula' data-placement="top">
                        Concluir Evaluación
                    </button>
                }
                    <button type="button" class="btn btn-primary float-right ml-3 btn_enviar" data-toggle="tooltip" title='Enviar la "Cédula" a la DAS' data-placement="top">Enviar a DAS</button>
                    <button type="button" class="btn btn-success float-right btn_guardar" data-toggle="tooltip" title='Guardar la información capturada sin enviar a la DAS' data-placement="top">Guardar Cédula</button>
            </div>
        </div>
    </div>
</div>

@* Modal para agregar facturas la cedula *@
<div class="modal fade" id="modal-facturas">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Agregar/Modificar Factura</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input class="form-control" id="idFactura" type="hidden" />
                <div class="row col-lg-12 mt-2">
                    <div class="form-group col-lg-6">
                        <label for="elegirArchivo">Seleccionar Archivo XML: </label>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input file_factura" id="fileFactura" accept=".xml">
                            <label class="custom-file-label" for="customFile">Subir "XML" de la factura</label>
                        </div>
                        <div class="col-sm-12 error_customFile">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione él archivo correspondiente
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="agregarFactura">Guardar Factura</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@* FIN del Modal para agregar facturas la cedula *@

@* Modal para ver las facturas de la cedula *@
<div class="modal fade" id="modal-ver-facturas">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Ver/Agregar Factura(s)</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <button class='btn btn-sm btn-primary mr-2 mb-3' data-toggle="tooltip" title="Agregar Facturas" data-placement="top" id="add_facturas">
                    <i class="fal fa-plus text-white"></i> Agregar Factura
                </button>
                <div class=" row col-lg-12">
                    <p>
                        <strong style="color: dodgerblue;">NOTA: </strong>Favor de revisar que los <strong style="color: dodgerblue;"> datos de la cédula </strong> resaltados en color <strong style="color: dodgerblue;">Azul </strong> coincidan con
                        la información de la factura que fue agregada.
                    </p>
                </div>
                <div class="tblFacturas scrollbar-deep-purple">
                    <div class="bodyFacturas">
                        <div class="mt-3">
                            <table class="table" id="listado_facturas">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Empresa</th>
                                        <th>Folio Fiscal</th>
                                        <th>Número Factura</th>
                                        <th>Subtotal Factura</th>
                                        <th>Total</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="listaFacturas"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.modal-content -->
</div>
<!-- /.modal-dialog -->
@* FIN del Modal para ver las facturas de la cedula *@

@* Modal para ver los conceptos de las facturas de la cedula *@
<div class="modal fade" id="modal-ver-conceptos">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white" id="factura_serie"></h4>
                <button type="button" class="close close_conceptos text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class=" row col-lg-12" id="detalle_conceptos"></div>
            </div>
        </div>
    </div>
    <!-- /.modal-content -->
</div>
<!-- /.modal-dialog -->
@* Fin de Modal para ver los conceptos de las facturas de la cedula *@

@* Modal para la captura de Incidencias *@
<div class="modal fade" id="modal-incidencias">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Registrar Incidencia del Programa de Operación</h4>
                <button type="button" class="close close-incidencias text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="form-row">
                            <input type="hidden" id="id_incidencia" />
                            <input type="hidden" id="id_pregunta" />
                            <div class="form-group col-md-6">
                                <label for="fechaIncidencia">Fecha de la Incidencia: </label>
                                <input type="date" class="form-control" id="fecha_incidencia" name="fechaIncidencia">
                                <div class="col-sm-12" id="error_fechaIncidencia">
                                    <small id="dateHelp" class="text-danger">
                                        Por favor capture la Fecha de la Incidencia
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-lg-6">
                        <label for="tipoIncidencia">Tipo de la Incidencia:</label>
                        <select class="form-control" id="tipo_incidencia">
                        </select>
                        <div class="col-sm-12" id="error_tipoInci">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el tipo de incidencia
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-lg-6">
                        <label for="areaIncidencia">Área:</label>
                        <select class="form-control" id="area_incidencia" disabled>
                        </select>
                        <div class="col-sm-12" id="error_areaInci">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el área correspondiente
                            </small>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-lg-12">
                        <label for="areaIncidencia">Comentarios:</label>
                        <textarea type="textarea" id="comentarios_incidencias" class="form-control" style="resize: none;" maxlength="256"></textarea>
                    </div>
                    <div class="col-sm-12" id="error_comentariosInci">
                        <small id="dateHelp" class="text-danger">
                            Por favor capture los comentarios correspondientes
                        </small>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-primary" id="guardaIncidencia">Guardar Incidencia</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para la captura de Incidencias *@

@* Modal para mostrar las Incidencias *@
<div class="modal fade" id="modal-consultaIncidencias">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Lista de Incidencias del Programa de Operación</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <table class="table table-responsive-xl">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Fecha de la Incidencia</th>
                                    <th>Tipo</th>
                                    <th>Área</th>
                                    <th>Comentarios</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tIncidencias"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="cerrar_modal">Cerrar</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para mostrar las Incidencias *@

@* Modal para la captura de Incidencias de Equipos*@
<div class="modal fade" id="modal-equipos">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Registrar Incidencia de Maquinaria y Equipo</h4>
                <button type="button" class="close close-incidencias text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="form-row">
                            <input type="hidden" id="id_incidencia" />
                            <input type="hidden" id="id_pregunta" />
                            <div class="form-group col-md-6">
                                <label for="fechaIncidencia">Fecha de la Incidencia: </label>
                                <input type="date" class="form-control" id="fecha_inciEquipo" name="fechaIncidencia">
                            </div>
                            <div class="col-sm-12" id="error_fechaIncidenciaEq">
                                <small id="dateHelp" class="text-danger">
                                    Por favor capture la Fecha de la Incidencia
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-lg-6">
                        <label for="tipoIncidencia">Tipo de la Incidencia:</label>
                        <select class="form-control" id="tipo_inciEquipo" disabled>
                            <option value='Equipo'>Equipo</option>
                        </select>
                    </div>
                    <div class="form-group col-lg-6">
                        <label for="areaIncidencia">Área:</label>
                        <select class="form-control" id="area_inciEquipo">
                        </select>
                        <div class="col-sm-12" id="error_areaInciEq">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el área correspondiente
                            </small>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-lg-12">
                        <label for="areaIncidencia">Comentarios:</label>
                        <textarea type="textarea" id="comentarios_inciEquipo" class="form-control" style="resize: none;"></textarea>
                    </div>
                    <div class="col-sm-12" id="error_comentariosInciEq">
                        <small id="dateHelp" class="text-danger">
                            Por favor capture los comentarios correspondientes
                        </small>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-primary" id="guardaInciEquipo">Guardar Incidencia</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para la captura de Incidencias *@

@* Modal para mostrar las Incidencias de Equipo *@
<div class="modal fade" id="modal-consultaIncidenciasEquipo">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Lista de Incidencias de Maquinaria y Equipo</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12">
                        <table class="table table-responsive-xl">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Fecha de la Incidencia</th>
                                    <th>Tipo</th>
                                    <th>Área</th>
                                    <th>Comentarios</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tIncidenciasEquipo"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="cerrar_modal">Cerrar</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para mostrar las Incidencias *@

@* Modal para la captura de Adjuntos *@
<div class="modal fade" id="modal_evidencias">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Adjuntar Entregables</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <input type="hidden" id="file_id" />
                    <div class="form-group col-lg-4">
                        <label for="tipoIncidencia">Tipo de Entregable:</label>
                        <select class="form-control" id="tipo_entregable">
                            @if ((@User.Claims.ElementAt(2).Value).Contains("Evaluador"))
                            {
                                <option value="">Seleccione un Entregable</option>
                                <option value="ActaER">Acta Entrega - Recepción</option>
                                <option value="Factura">Factura</option>
                                <option value="SAT">Validación del SAT</option>
                                <option value="NotaCredito">Nota de Crédito</option>
                                <option value="Reporte(s)">Reporte(s)</option>
                            }
                            else
                            {
                                <option value="">Seleccione un Entregable</option>
                                <option value="EBD">Entregable Bajo Demanda</option>
                            }
                        </select>
                        <div class="col-sm-12" id="error_tipoEntre">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el tipo de entregable
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-lg-6">
                        <label for="elegirArchivo">Seleccionar Archivo: </label>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="customFile" accept=".pdf">
                            <label class="custom-file-label" for="customFile">Seleccionar Archivo</label>
                        </div>
                        <div class="col-sm-12" id="error_customFile">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el archivo correspondiente
                            </small>
                        </div>
                    </div>
                    <div class="form-row col-lg-12 mt-2" id="comentariosEntregable">
                        <div class="form-group mt-2 col-md-12">
                            <label for="fechaCierre">Comentarios:</label><br>
                            <textarea id="comentarios_entregable" class="form-control float-left"></textarea>
                            <div class="col-sm-12" id="error_comentariosEntre">
                                <small id="comentariosHelp" class="text-danger">
                                    Por favor capture los comentarios correspondientes
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="adjuntarArchivo">Adjuntar Entregable</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para la captura de Incidencias *@

@* Modal para la ver Adjuntos *@
<div class="modal fade" id="modal_pdf">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white" id="titlePDF"></h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <td><strong>Folio: </strong> @Model.Folio</td>
                        <td><strong>Año: </strong>@Model.Anio</td>
                        <td><strong>Mes: </strong>@Model.Mes</td>
                        <td><strong>Inmueble: </strong>@Model.inmuebles.Nombre</td>
                    </tr>
                    <tr>
                        <td colspan="4"><strong>Estatus: </strong>@Model.Estatus </td>
                    </tr>
                </table>
                <div class="row" id="entregablePDF"></div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para ver Adjuntos*@

@section Scripts{
    <script>
            window.onload = function () {
            var meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            var totalPreguntas = '@Model.RespuestasEncuesta.Count';
            var respuestas = @Html.Raw(Json.Serialize(@Model.RespuestasEncuesta));
            var model = @Html.Raw(Json.Serialize(@Model));
            var editIncidencia = "";

                /*OVerLayScrollBar*/
                $("#scrollBar").overlayScrollbars({
                    className: "os-theme-thick-light",
                    resize: "none",
                });

                $('[data-toggle="tooltip"]').tooltip();
                $('.error_customFile').css('display', 'none');

            /*Llenamos el Combo de Meses de Correspondencia*/
                let optionsMes = "<option value=''>Selecciona el Mes</option>";
                meses.forEach(function (mes) {
                    optionsMes += "<option value=" + mes + ">" + mes + "</option>"
                });
                $("#mes_correspondiente").html(optionsMes);
            /*Fin del Combo de inmuebles*/

            /*Ocultamos los Divs que contienen los botones para incidencias y para adjuntar archivos*/
                $('#campos').css('display', 'none');
                $('#comentariosActa').css('display', 'none');
                $('#incidencias_pr2').css('display', 'none');
                $('#comentariosSua').css('display', 'none');
                $('#incidencias_pr4').css('display', 'none');
                $('#fechaEntregaRecepcion').css('display', 'none');
                $('#evidencia_inasistencias').css('display', 'none');
                $('#evidencia_acta').css('display', 'none');
                $('#fileActa').css('display', 'none');
                /*FIN Ocultamos los Divs que contienen los botones para incidencias y para adjuntar archivos*/

            /*************** Div's de Errores de Captura ******************/

                /*Incidencias NO EQUIPOS*/
                    $('#error_fechaIncidencia').css('display', 'none');
                    $('#error_tipoInci').css('display', 'none');
                    $('#error_areaInci').css('display', 'none');
                    $('#error_comentariosInci').css('display', 'none');

                /*Incidencias Equipos*/
                    $('#error_fechaIncidenciaEq').css('display', 'none');
                    $('#error_areaInciEq').css('display', 'none');
                    $('#error_comentariosInciEq').css('display', 'none');

                /*Adjuntar Archivos*/
                    $('#error_tipoEntre').css('display', 'none');
                    $('#error_customFile').css('display', 'none');
                    $('#error_comentariosEntre').css('display', 'none');

            /*************** Div's de Errores de Captura ******************/

            /********************************Acciones para los controles adicionales en las preguntas ***********************/
                $('.pregunta2').change(function () {
                let pr2 = $(this).val();
                if (pr2 == "false") {
                    $('#incidencias_pr2').css('display', 'block');
                } else {
                    /*Validamos que no tengan Incidencias*/
                    axios.get("/limpieza/getIncidencias", { params: { cedulaId: parseInt(@Model.Id) } }).then(response => {
                            if (response.data.length > 0) {
                                Swal.fire({
                                    'icon': 'warning',
                                    'title': 'Servicio de Limpieza y Áreas Comunes',
                                    'html': '<strong>Advertencia:</strong><p>Tienes incidencias capturadas en esta pregunta, al cambiar la respuesta de "NO" a "SI" '+
                                        '<strong>se borrarán todas las incidencias. ¿Deseas continuar? </strong></p>',
                                    'confirmButtonColor': '#3085d6',
                                    'cancelButtonColor': '#d33',
                                    'confirmButtonText': 'Si, deseo continuar',
                                    'cancelButtonText': 'Cancelar',
                                    'showCancelButton': true
                                }).then(p => {
                                    if (p.isConfirmed) {
                                        Swal.fire({
                                            'icon': 'warning',
                                            'title': 'Servicio de Limpieza y Áreas Comunes',
                                            'text': 'Escriba la palabra BORRAR para confirmar el cambio de respuesta.',
                                            'confirmButtonColor': '#3085d6',
                                            'cancelButtonColor': '#d33',
                                            'confirmButtonText': 'Si, eliminar todo',
                                            'cancelButtonText': 'Cancelar',
                                            'showCancelButton': true,
                                            'input': 'text',
                                            'inputPlaceholder': 'Escribe la palabra BORRAR'
                                        }).then(res => {
                                            if (res.value == 'BORRAR') {
                                                axios.get('/limpieza/eliminarIncidencias/' + model.id).then(r => {
                                                    Swal.fire({
                                                        'icon': 'success',
                                                        'title': 'Borrado finalizado',
                                                        'text': 'Las incidencias de esta pregunta fueron eliminadas exitósamente.',
                                                    }).then(function () {
                                                        $('input:radio[name="pregunta2"][value="true"]').prop('checked', true);
                                                        $('#incidencias_pr2').css('display', 'none');
                                                        $('.btn_guardar').trigger('click');
                                                    });
                                                });
                                            } else {
                                                Swal.fire({
                                                    'icon': 'error',
                                                    'title': 'Error de escritura',
                                                    'text': 'Debes escribir correctamente la palabra BORRAR.',
                                                });
                                                $('#incidencias_pr2').css('display', 'block');
                                                $('input:radio[name="pregunta2"][value="false"]').prop('checked', true);
                                            }
                                        });
                                    } else {
                                        $('#incidencias_pr2').css('display', 'block');
                                        $('input:radio[name="pregunta2"][value="false"]').prop('checked', true);
                                    }
                                });
                        } else{
                            $('#incidencias_pr2').css('display', 'none');
                        }
                        });
                    /*Fin de la Validacion de Incidencias*/
                }
            });

                $('.pregunta4').change(function () {
                let pr4 = $(this).val();
                if (pr4 == "false") {
                    $('#incidencias_pr4').css('display', 'block');
                } else {
                    /*Validamos que no tengan Incidencias*/
                    axios.get("/limpieza/getIncidenciasEquipo", { params: { cedulaId: parseInt(@Model.Id) } }).then(response => {
                            if (response.data.length > 0) {
                                Swal.fire({
                                    'icon': 'warning',
                                    'title': 'Servicio de Limpieza y Áreas Comunes',
                                    'html': '<strong>Advertencia:</strong><p>Tienes incidencias capturadas en esta pregunta, al cambiar la respuesta de "NO" a "SI" '+
                                        '<strong>se borrarán todas las incidencias. ¿Deseas continuar? </strong></p>',
                                    'confirmButtonColor': '#3085d6',
                                    'cancelButtonColor': '#d33',
                                    'confirmButtonText': 'Si, deseo continuar',
                                    'cancelButtonText': 'Cancelar',
                                    'showCancelButton': true
                                }).then(p => {
                                    if (p.isConfirmed) {
                                        Swal.fire({
                                            'icon': 'warning',
                                            'title': 'Servicio de Limpieza y Áreas Comunes',
                                            'text': 'Escriba la palabra BORRAR para confirmar el cambio de respuesta.',
                                            'confirmButtonColor': '#3085d6',
                                            'cancelButtonColor': '#d33',
                                            'confirmButtonText': 'Si, eliminar todo',
                                            'cancelButtonText': 'Cancelar',
                                            'showCancelButton': true,
                                            'input': 'text',
                                            'inputPlaceholder': 'Escribe la palabra BORRAR'
                                        }).then(res => {
                                            if (res.value == 'BORRAR') {
                                                axios.get('/limpieza/eliminaIncidenciasEquipo/' + model.id).then(r => {
                                                    Swal.fire({
                                                        'icon': 'success',
                                                        'title': 'Borrado finalizado',
                                                        'text': 'Las incidencias de esta pregunta fueron eliminadas exitósamente.',
                                                    }).then(function () {
                                                        $('input:radio[name="pregunta4"][value="true"]').prop('checked', true);
                                                        $('#incidencias_pr4').css('display', 'none');
                                                        guardaCedula();
                                                    });
                                                });
                                            } else {
                                                Swal.fire({
                                                    'icon': 'error',
                                                    'title': 'Error de escritura',
                                                    'text': 'Debes escribir correctamente la palabra BORRAR.',
                                                });
                                                $('#incidencias_pr4').css('display', 'block');
                                                $('input:radio[name="pregunta4"][value="false"]').prop('checked', true);
                                            }
                                        });
                                    } else {
                                        $('#incidencias_pr4').css('display', 'block');
                                        $('input:radio[name="pregunta4"][value="false"]').prop('checked', true);
                                    }
                                });
                        } else{
                            $('#incidencias_pr4').css('display', 'none');
                        }
                        });
                    /*Fin de la Validacion de Incidencias*/
                    $('#incidencias_pr4').css('display', 'none');
                }
            });

                $('.pregunta5').change(function () {
                    let pr5 = $(this).val();
                    let fol = '@Model.Folio';
                    if (pr5 == "true") {
                        $('#evidencia_inasistencias').css('display', 'block');
                    } else {
                        $('#detalle5').val('');
                        $('#evidencia_inasistencias').css('display', 'none');
                    }
                });

                $('.pregunta6').change(function () {
                    let pr6 = $(this).val();
                    let fol = '@Model.Folio';
                    if (pr6 == "true") {
                        $('#campos').css('display', 'block');
                        $('#comentariosSua').css('display', 'none');
                        $('#comentarios_sua').val('');
                    } else {
                        $('#campos').css('display', 'none');
                        $('#comentariosSua').css('display', 'block');
                        $('#mes_correspondiente').val('');
                        $('#detalle6').val('');
                    }
                });

                $('.pregunta7').change(function () {
                let pr7 = $(this).val();
                if (pr7 == "false") {
                    $('#comentariosActa').css('display', 'block');
                    $('#evidencia_acta').css('display', 'none');
                    $('#detalle7').val(null);
                } else {
                    $('#comentariosActa').css('display', 'none');
                    $('#evidencia_acta').css('display', 'block');
                    $('#comentarios_acta').val('');
                }
                });



            /**********************************Agregar/Cambiar los valores de la Cédula*************************************/
                /*Proceso para editar la cedula*/
                    $(document).on('click','.update_factura',function () {
                        var id = $(this).data('id');

                        $("#idFactura").val(id);

                        $('#modal-ver-facturas').modal('hide');
                        $("#modal-facturas").modal('show');

                    });

                    $(document).on('click','.view_factura',function () {
                        var id = $(this).data('id');
                        var divTbl = "";
                        $('#modal-ver-facturas').modal('hide');
                        axios.get('/limpieza/getFacturas/' + model.id + '/' + 1).then(table => {
                            $("#factura_serie").text("Detalle de la Factura: " + table.data[id].comprobante.serie + table.data[id].comprobante.folio);
                            var conceptos = table.data[id].concepto;

                            for (var i = 0; i < conceptos.length; i++) {
                                divTbl += '<div class="row col-lg-12 mt-1">' +
                                    '<table class="table table-borderless">' +
                                    '<tr>' +
                                        '<td colspan="4"><strong>Concepto: </strong>' + conceptos[i].descripcion + '</td>'+
                                    '</tr>'+
                                    '<tr>' +
                                    '    <td data-toggle="tooltip" title="Número de elementos que prestaron el servicio en el mes" data-placement="top" id="concepto_cantidad"><strong>Cantidad: </strong>' + table.data[id].concepto[i].cantidad + '</td>' +
                                    '    <td data-toggle="tooltip" title="Clave del Producto o Servicio Facturado" data-placement="top" id="concepto_cveProduc"><strong>Clave del Producto: </strong>' + table.data[id].concepto[i].claveProdServ + '</td>' +
                                    '    <td data-toggle="tooltip" title="Clave de la Medida en Base al Servicio" data-placement="top" id="concepto_medida"><strong>Clave de Medida: </strong>' + table.data[id].concepto[i].claveUnidad + '</td>' +
                                    '    <td data-toggle="tooltip" title="Unidad de Medida" data-placement="top" id="concepto_unidadMed"><strong>Unidad de Medida: </strong>' + table.data[id].concepto[i].unidad + '</td>' +
                                    '    <td data-toggle="tooltip" title="Tipo de CFDI" data-placement="top" id="tipo_cfdi"><strong>Uso de CFDI: </strong>' + table.data[id].receptor.usoCFDI + '</td>' +
                                    '    <td data-toggle="tooltip" title="Valor unitario por unidad" data-placement="top" id="concepto_unitario"><strong>Precio Unitario: </strong> $ ' + (table.data[id].concepto[i].valorUnitario).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</td>' +
                                    '</tr>' +
                                    '<tr>' +
                                    '    <td data-toggle="tooltip" title="IVA del subtotal del 16%" data-placement="top" id="concepto_iva"><strong>IVA: </strong> $ ' + (table.data[id].traslado.importe).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</td>' +
                                    '    <td data-toggle="tooltip" title="Importe total de la facturación" data-placement="top" id="concepto_total"><strong>Total: </strong> $ ' + (table.data[id].concepto[i].importe).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</td>' +
                                    '    <td colspan="3"></td>' +
                                    '</tr>' +
                                    '</table>' +
                                    '</div>';
                            }
                            $("#detalle_conceptos").html(divTbl);
                            $('#modal-ver-conceptos').modal('show');
                        });
                   });

                    $(document).on('click', '.delete_factura', function () {
                        var id = $(this).data('id');
                        var serie = $(this).data('serie');
                        var descripcion = $(this).data('descr');
                        var folio = serie + $(this).data('folio')+"";

                        Swal.fire({
                            'icon': 'warning',
                            'title': 'Servicio de Limpieza y Áreas Comunes',
                            'html': '<strong>Advertencia:</strong><p>¿Deseas eliminar la factura con Folio <strong>' + folio + '</strong> correspondiente al <strong>' +
                                descripcion +'</strong>?</p>',
                            'confirmButtonColor': '#3085d6',
                            'cancelButtonColor': '#d33',
                            'confirmButtonText': 'Si, deseo continuar',
                            'cancelButtonText': 'Cancelar',
                            'showCancelButton': true
                        }).then(yes => {
                            if (yes.isConfirmed) {
                                Swal.fire({
                                    'icon': 'warning',
                                    'title': 'Servicio de Limpieza y Áreas Comunes',
                                    'text': 'Escriba la palabra ELIMINAR en mayúsculas para confirmar el borrado de la factura con folio: '+folio,
                                    'confirmButtonColor': '#3085d6',
                                    'cancelButtonColor': '#d33',
                                    'confirmButtonText': 'Si, eliminar',
                                    'cancelButtonText': 'Cancelar',
                                    'showCancelButton': true,
                                    'input': 'text',
                                    'inputPlaceholder': 'Escribe la palabra ELIMINAR'
                                }).then(del => {
                                    if (del.value == 'ELIMINAR') {
                                        axios.delete('/limpieza/deleteFactura/'+id).then(del => {
                                            Swal.fire({
                                                'icon': 'success',
                                                'title': 'Borrado finalizado',
                                                'text': 'La factura fue eliminada exitósamente.',
                                            }).then(function () {
                                                window.location.reload();
                                            });
                                        })
                                    }
                                });
                            }
                        });
                    });

                $(".file_factura").change(function (e) {
                    var archivo = e.target.files[0];
                    var fileName = $(this).val().split("\\").pop();
                    var ext = fileName.split('.').pop();
                    if (ext == "xml") {
                        $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                        if ($('.file_factura').hasClass('is-invalid')) {
                            $('.file_factura').removeClass('is-invalid');
                            $('.file_factura').addClass('is-valid');
                            $('.error_customFile').css('display', 'none')
                        } else {
                            $('.file_factura').addClass('is-valid');
                        }
                    } else {
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Formato Incorrecto',
                            'text': 'El archivo que intentas adjuntar no es válido. Favor de solo seleccionar archivos "Xml"'
                        });
                        $(".custom-file-label").text("Seleccionar Archivo");
                        document.getElementById('customFile').value = '';
                        if ($('.file_factura').hasClass('is-valid')) {
                            $('.file_factura').removeClass('is-valid');
                            $('.file_factura').addClass('is-invalid');
                        }
                        $('.file_factura').addClass('is-invalid');
                        $('.error_customFile').css('display', 'block');
                    }
                });

                function validaCamposArchivoXml() {
                    if ($('.file_factura').val() == "") {
                        $('.file_factura').addClass('is-invalid');
                        $('.error_customFile').css('display', 'block');

                        return false;
                    }
                    return true;
                }

                 $('#agregarFactura').click(function () {
                     var id = $("#idFactura").val();

                     var formData = new FormData();
                     var file = document.getElementById('fileFactura').files[0];

                     if (id.length > 0) {
                         id = parseInt(id);
                     } else {
                         id = 0;
                     }

                     formData.append("Id", id);
                     formData.append("ServicioId", 1);
                     formData.append("CedulaId", model.id);
                     formData.append("Xml", file);
                     if (validaCamposArchivoXml() == true) {
                         if (id == "") {
                             axios.post('/limpieza/insertaFactura', formData).then(fact => {
                                 Swal.fire({
                                     'icon': "success",
                                     'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                     'html': 'La factura fue agregada a la cédula de forma correcta.'
                                 }).then(function () {
                                     window.location.reload();
                                 });
                             });
                         } else {
                             axios.post('/limpieza/updateFactura', formData).then(fact => {
                                 Swal.fire({
                                     'icon': "success",
                                     'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                     'html': 'La factura fue actualizada de forma correcta.'
                                 }).then(function () {
                                     window.location.reload();
                                 });
                             });
                         }
                     }

                 });
                /*FIN del proceso para editar la cedula*/

                /*Ver Facturas*/
                $("#btn_facturas").click(function () {
                    axios.get('/limpieza/getFacturas/' + model.id + '/' + 1).then(table => {
                        var facturas = table.data;
                        for (var i = 0; i < facturas.length; i++) {
                            table += "<tr>" +
                                "<td>" + (i + 1) + "</td>" +
                                "<td>" + facturas[i].emisor.nombre + "</td>" +
                                "<td>" + facturas[i].timbreFiscal.uuid + "</td>" +
                                "<td>" + (facturas[i].comprobante.serie + "" + facturas[i].comprobante.folio) + "</td>" +
                                "<td> $" + parseFloat(facturas[i].comprobante.subTotal).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + "</td>" +
                                "<td> $" + parseFloat(facturas[i].comprobante.total).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + "</td>" +
                                "<td>" +
                                "<a class='view_factura' href='#' data-id='" + i + "'><i class='far fa-list text-success'></i></a>" +
                                "<a class='update_factura' href='#' data-id='" + facturas[i].id + "'><i class='fad fa-pencil text-primary ml-2'></i></a>" +
                                "<a class='delete_factura' href='#' data-id='" + facturas[i].id + "' data-serie='" + facturas[i].comprobante.serie +
                                "' data-folio='" + facturas[i].comprobante.folio + "' data-total='" + facturas[i].comprobante.total + "' " +
                                " data-descr='" + facturas[i].concepto.descripcion + "'><i class='fad fa-times text-danger ml-2'></i></a>" +
                                "</td>" +
                                "</tr>";
                        }
                        $("#listaFacturas").html(table);
                        if (facturas.length == 0) {
                            $("#listado_facturas").hide();
                        } else {
                            $("#listado_facturas").show();
                        }
                    });
                    $('#modal-ver-facturas').modal('show');
                });
                /*Fin de Ver Facturas*/

                /*Agregar Facturas*/
                    $('#add_facturas').click(function () {
                        $("#idFactura").val('');
                        $('#modal-ver-facturas').modal('hide');
                        $('#modal-facturas').modal('show');
                    });
                /*Fin Agregar Facturas*/


            /******************************* FIN Agregar/Cambiar los valores de la Cédula **********************************/

            /************************************** Editar Cuestionario de la Cédula ***************************************/
                /*Si existen Respuestas dentro de la Cedula*/
                var tipoPregunta = null;
                for (var i = 0; i < respuestas.length; i++) {
                    tipoPregunta = $('.pregunta' + respuestas[i].pregunta).attr("type");
                    if (tipoPregunta == "radio") {
                        $('input:radio[name="pregunta' + respuestas[i].pregunta + '"][value="' + respuestas[i].respuesta + '"]').prop('checked', true);
                        if (respuestas[i].pregunta == 2 && respuestas[i].respuesta == false) {
                            $('#incidencias_pr2').css('display', 'block');
                        }

                        if (respuestas[i].pregunta == 4 && respuestas[i].respuesta == false) {
                            $('#incidencias_pr4').css('display', 'block');
                        }

                        if (respuestas[i].pregunta == 5 && respuestas[i].respuesta == true) {
                            $('#inasistencias').css('display', 'block');
                            $('#detalle' + respuestas[i].pregunta).val(respuestas[i].detalles);
                            $('#evidencia_inasistencias').css('display', 'block');
                        }

                        if (respuestas[i].pregunta == 6 && respuestas[i].respuesta == true) {
                            var resp = respuestas[i].detalles.split("|");
                            $('#detalle' + respuestas[i].pregunta).val(resp[0]);
                            $('#mes_correspondiente').val(resp[1]);
                            $('#campos').css('display', 'block');
                        }
                        else if (respuestas[i].pregunta == 6 && respuestas[i].respuesta == false) {
                            $('#campos').css('display', 'none');
                            $('#comentariosSua').css('display', 'block');
                            $('#comentarios_sua').val(respuestas[i].detalles);
                        }

                        if (respuestas[i].pregunta == 7 && respuestas[i].respuesta == true) {
                            $('#fechaEntregaRecepcion').css('display', 'block');
                            $('#comentariosActa').css('display', 'none');
                            $('#detalle' + respuestas[i].pregunta).val(respuestas[i].detalles);
                            $('#evidencia_acta').css('display', 'block');
                            $('#comentarios_acta').val('');
                        }
                        else if (respuestas[i].pregunta == 7 && respuestas[i].respuesta == false) {
                            $('#comentariosActa').css('display', 'block');
                            $('#fechaEntregaRecepcion').css('display', 'none');
                            $('#comentarios_acta').val(respuestas[i].detalles);
                        }
                    }
                    else if (tipoPregunta == "date") {
                        $('.pregunta' + respuestas[i].pregunta).val(respuestas[i].detalles);
                    }
                }
                /*Fin Acciones para los controles adicionales en las preguntas*/
            /******************************** FIN de Editar Cuestionario de la Cédula *************************************/

            /************************************** INCIDENCIAS (NO EQUIPO) ***************************************/

                /*Modal para Incidencias y Llenado de los Tipo*/
                    $('#btn_addInci').click(function () {
                        $('#modal-incidencias').modal('show');
                        $('#id_incidencia').val('');
                        $('#id_pregunta').val($(this).data('pregunta'));
                    });

                    axios.get("/limpieza/getTiposIncidencia").then(response => {
                        var tipos = "<option value=''>Seleccione un Tipo de Incidencia</option>";
                        for (let i = 0; i < response.data.length; i++) {
                            tipos += "<option value='" + response.data[i].tipo + "'>" + response.data[i].tipo + "</option>";
                        }
                        $("#tipo_incidencia").html(tipos);
                        $('#area_incidencia').removeAttr('disabled');
                    });
                /*Llenamos la Lista desplegable con los Tipo de Incidencia*/

                /*Llenado de Areas al Seleccionar el Tipo de Incidencia*/
                    $('#tipo_incidencia').change(function () {
                        /*Cargamos los nombres de area en base al tipo de Incidencias*/
                        var tipos = "<option value=''>Seleccione el Área</option>";
                        var incidencia = $(this).val();
                        axios.get("/limpieza/getTiposNombre", { params: { tipo: incidencia } }).then(response => {
                            for (let i = 0; i < response.data.length; i++) {
                                tipos += "<option value='" + response.data[i].nombre + "'>" + response.data[i].nombre + "</option>";
                            }
                            $("#area_incidencia").html(tipos);
                            if (editIncidencia != "") {
                                $('#area_incidencia option[value="' + editIncidencia + '"]').attr('selected', 'selected');
                            }
                        });
                    });
                /*FIN Llenado de Areas al Seleccionar el Tipo de Incidencia*/

                /*Mostrar Incidencias Capturadas*/
                    $('#consulta_incidencias').click(function () {
                        $('#modal-consultaIncidencias').modal('show');
                        axios.get("/limpieza/getIncidencias", { params: { cedulaId: parseInt(@Model.Id) } }).then(response => {
                            $('#tIncidencias').html(response.data);
                        });
                    });
                /*FIN de Mostrar Incidencias Capturadas*/

                /*Actualiza Incidencia*/
                    $(document).on("click", ".update_incidencia", function () {
                        let id = parseInt($(this).data('id'));
                        $('#modal-consultaIncidencias').modal('hide');
                            axios.get("/limpieza/getIncidencia", { params: { cedulaId: id } }).then(response => {
                                $('#id_incidencia').val(response.data.id);
                                $('#tipo_incidencia').val(response.data.incidencia.tipo).change();
                                $('#comentarios_incidencias').val(response.data.comentarios);
                                $('#fecha_incidencia').val(response.data.fechaIncidencia.slice(0, 10));
                                editIncidencia = response.data.incidencia.nombre;
                                $('#fecha_incidencia').addClass('is-valid');
                                $('#area_incidencia').addClass('is-valid');
                                $('#comentarios_incidencias').addClass('is-valid');
                            });

                            $('#modal-incidencias').modal('show');
                    });
                /*Fin de Actualiza Incidencia*/

                /*Eliminar Incidencia*/
                 $(document).on("click",".delete_incidencia",function(){
                    var id = $(this).data("id");

                    Swal.fire({
                            'icon': 'warning',
                            'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                            'html': '¿Está seguro de eliminar la incidencia?',
                            'confirmButtonColor': '#3085d6',
                            'cancelButtonColor': '#d33',
                            'confirmButtonText': 'Sí, eliminar incidencia',
                            'cancelButtonText': 'Cancelar',
                            'showCancelButton': true
                        }).then(response => {
                            if (response.isConfirmed) {
                                axios.get("/limpieza/incidencia/eliminar/"+id).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire(
                                            'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                            'La incidencia fue eliminada con éxito.',
                                            'success'
                                        ).then(function () {
                                            window.location.reload();
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire(
                                        'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'No se pudo eliminar la incidencia. Contacte al Administrador del Sistema.',
                                        'error'
                                    );
                                });
                            }
                        });

                });
                /*Fin de Eliminar Incidencia*/

                /*Guarda la Incidencia (NO EQUIPO)*/
                function validaCamposIncidencia() {
                        var isContinue = false;

                        if ($('#fecha_incidencia').val() == "") {

                            $('#fecha_incidencia').addClass('is-invalid');
                            $('#error_fechaIncidencia').css('display', 'block');

                        }

                        if ($('#tipo_incidencia').val() == "") {

                            $('#tipo_incidencia').addClass('is-invalid');
                            $('#error_tipoInci').css('display', 'block');

                        }

                        if ($('#comentarios_incidencias').val() == "") {

                            $('#comentarios_incidencias').addClass('is-invalid');
                            $('#error_comentariosInci').css('display', 'block');

                        }

                        if ($('#area_incidencia').val() == "" || $('#area_incidencia').val() == null) {
                            $('#area_incidencia').addClass('is-invalid');
                            $('#error_areaInci').css('display', 'block');

                        }

                        if ($('#fecha_incidencia').val() != "" && $('#tipo_incidencia').val() != "" && $('#comentarios_incidencias').val() != "" &&
                            $('#area_incidencia').val() != "") {
                            isContinue = true;
                            }

                        return isContinue;
                }

                $('#guardaIncidencia').click(function () {
                        let html = "";
                        let id = $('#id_incidencia').val();
                        let fecha = $('#fecha_incidencia').val();
                        let pregunta = $('#id_pregunta').val();
                        let tipo = $('#tipo_incidencia').val();
                        let area = $('#area_incidencia').val();
                        let comentarios = $('#comentarios_incidencias').val();
                        if (id == "" || id == null) {
                            id = 0;
                        }
                        if (validaCamposIncidencia()) {
                            axios.post("/limpieza/guardaIncidencias", { Id: parseInt(id), CedulaLimpiezaId: @Model.Id, FechaIncidencia: fecha, Comentarios: comentarios, Pregunta: parseInt(pregunta),
                                                                    Incidencia: { Tipo: tipo, Nombre: area }
                            }).then(response => {
                                if (response.status == 200) {
                                    if (id != 0) {
                                        html = "actualizada";
                                    } else {
                                        html = "registrada";
                                    }
                                    Swal.fire({
                                        'icon': "success",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': "La incidencia presentada en las actividades del programa de operación fue "+html+" de forma correcta."
                                    });
                                    guardaCedula();
                                    axios.get("/limpieza/getIncidencias",{ params: { cedulaId: parseInt(@Model.Id) } }).then(response => {
                                        $('#tIncidencias').html(response.data);
                                    });
                                    $('#cerrar_modal').trigger('click');
                                    $('#id_incidencia').val("");
                                    $('#fecha_incidencia').val("");
                                    $('#tipo_incidencia').val("");
                                    $('#area_incidencia').val("");
                                    $('#comentarios_incidencias').val("");
                                    $('#fecha_incidencia').removeClass('is-valid');
                                    $('#tipo_incidencia').removeClass('is-valid');
                                    $('#area_incidencia').removeClass('is-valid');
                                    $('#comentarios_incidencias').removeClass('is-valid');

                                }
                            });
                        }
                    });
                /*Fin de Guarda la Incidencia (NO EQUIPO)*/

                /* Quita errores */
                    $('#fecha_incidencia').change(function () {
                        if ($(this).val() != "") {
                            $('#fecha_incidencia').removeClass('is-invalid');
                            $('#fecha_incidencia').addClass('is-valid');
                            $('#error_fechaIncidencia').css('display', 'none');
                        } else {
                            $('#fecha_incidencia').addClass('is-invalid');
                            $('#error_fechaIncidencia').css('display', 'block');
                        }
                    });

                    $('#tipo_incidencia').change(function () {
                        if ($(this).val() != "") {
                            $('#tipo_incidencia').removeClass('is-invalid');
                            $('#tipo_incidencia').addClass('is-valid');
                            $('#error_tipoInci').css('display', 'none');
                        } else {
                            $('#tipo_incidencia').addClass('is-invalid');
                            $('#error_tipoInci').css('display', 'block');
                        }
                    });

                    $('#area_incidencia').change(function () {
                        if ($(this).val() != "") {
                            $('#area_incidencia').removeClass('is-invalid');
                            $('#area_incidencia').addClass('is-valid');
                            $('#error_areaInci').css('display', 'none');
                        } else {
                            $('#area_incidencia').addClass('is-invalid');
                            $('#error_areaInci').css('display', 'block');
                        }
                     });

                    $('#comentarios_incidencias').change(function () {
                        if ($(this).val() != "") {
                            $('#comentarios_incidencias').removeClass('is-invalid');
                            $('#comentarios_incidencias').addClass('is-valid');
                            $('#error_comentariosInci').css('display', 'none');
                        } else {
                            $('#comentarios_incidencias').addClass('is-invalid');
                            $('#error_comentariosInci').css('display', 'block');
                        }
                    });

               /* FIN Quita errores */



            /************************************** FIN INCIDENCIAS (NO EQUIPO) ***********************************/


            /**************************************** INCIDENCIAS (EQUIPO) ****************************************/

                /*Incidencias Equipo*/
                    $('#btn_inciEquipo').click(function () {
                        /*Cargamos los nombres de area en base al tipo de Incidencias*/
                        var tipos = "<option value=''>Seleccione el Área</option>";
                        var incidencia = 'Equipo';
                        axios.get("/limpieza/getTiposNombre", { params: { tipo: incidencia } }).then(response => {
                            for (let i = 0; i < response.data.length; i++) {
                                tipos += "<option value='" + response.data[i].nombre + "'>" + response.data[i].nombre + "</option>";
                            }
                            $("#area_inciEquipo").html(tipos);
                            if (editIncidencia != "") {
                                $('#area_inciEquipo option[value="' + editIncidencia + '"]').attr('selected', 'selected');
                            }
                        });
                        $('#id_pregunta').val($(this).data('pregunta'));
                        $('#modal-equipos').modal('show');
                    });
                /*FIN Incidencias Equipo*/

                /*Mostrar Incidencias de Equipo*/
                    $('#btn_showInciEquipo').click(function () {
                        axios.get("/limpieza/getIncidenciasEquipo",{ params: { cedulaId: parseInt(@Model.Id) } }).then(response => {
                            $('#tIncidenciasEquipo').html(response.data);
                        });
                        $('#modal-consultaIncidenciasEquipo').modal('show');
                    });
                /*FIN de Mostrar Incidencias de Equipo*/

                 /*Actualiza Incidencia*/
                    $(document).on("click", ".update_incidenciaEq", function () {
                        let id = parseInt($(this).data('id'));
                        var tipos = "<option value=''>Seleccione el Área</option>";
                        var incidencia = 'Equipo';
                        axios.get("/limpieza/getTiposNombre", { params: { tipo: incidencia } }).then(response => {
                            for (let i = 0; i < response.data.length; i++) {
                                tipos += "<option value='" + response.data[i].nombre + "'>" + response.data[i].nombre + "</option>";
                            }
                            $("#area_inciEquipo").html(tipos);
                        });
                        $('#modal-consultaIncidenciasEquipo').modal('hide');
                        axios.get("/limpieza/getIncidencia", { params: { cedulaId: id } }).then(response => {
                                $('#id_incidencia').val(response.data.id);
                                $('#area_inciEquipo option[value="' + response.data.incidencia.nombre + '"]').attr('selected', 'selected');
                                $('#comentarios_inciEquipo').val(response.data.comentarios);
                                $('#fecha_inciEquipo').val(response.data.fechaIncidencia.slice(0, 10));
                                editIncidencia = response.data.incidencia.nombre;
                            });

                        $('#modal-equipos').modal('show');
                    });
                /*Fin de Actualiza Incidencia*/

                /*Guarda la Incidencia*/
                    function validaCamposIncidenciaIncidenciaEquipo() {
                        if ($('#fecha_inciEquipo').val() == "" && $('#area_inciEquipo').val() == "" && $('#comentarios_inciEquipo').val() == "") {

                            $('#fecha_inciEquipo').addClass('is-invalid');
                            $('#error_fechaIncidenciaEq').css('display', 'block');

                            $('#area_inciEquipo').addClass('is-invalid');
                            $('#error_areaInciEq').css('display', 'block');

                            $('#comentarios_inciEquipo').addClass('is-invalid');
                            $('#error_comentariosInciEq').css('display', 'block');
                            return false;
                        }

                        if ($('#fecha_inciEquipo').val() == "" && $('#tipo_inciEquipo').val() == "") {

                            $('#fecha_inciEquipo').addClass('is-invalid');
                            $('#error_fechaIncidenciaEq').css('display', 'block');

                            $('#tipo_inciEquipo').addClass('is-invalid');
                            $('#error_tipoInciEq').css('display', 'block');

                            $('#area_incidencia').addClass('is-invalid');
                            $('#error_areaInci').css('display', 'block');

                            return false;
                        }

                        if ($('#fecha_inciEquipo').val() == "" && $('#comentarios_incidencias').val() == "") {

                            $('#fecha_inciEquipo').addClass('is-invalid');
                            $('#error_fechaIncidenciaEq').css('display', 'block');

                            $('#comentarios_incidencias').addClass('is-invalid');
                            $('#error_comentariosInciEq').css('display', 'block');
                            return false;
                        }

                        if ($('#comentarios_inciEquipo').val() == "") {
                            $('#comentarios_inciEquipo').addClass('is-invalid');
                            $('#error_comentariosInciEq').css('display', 'block');
                            return false;
                        }

                        if ($('#tipo_inciEquipo').val() == "") {

                            $('#tipo_inciEquipo').addClass('is-invalid');
                            $('#error_tipoInciEq').css('display', 'block');

                            return false;
                        }

                        return true;
                    }

                    $('#guardaInciEquipo').click(function () {
                        let html = "";
                        let id = $('#id_incidencia').val();
                        let fecha = $('#fecha_inciEquipo').val();
                        let tipo = $('#tipo_inciEquipo').val();
                        let area = $('#area_inciEquipo').val();
                        let comentarios = $('#comentarios_inciEquipo').val();
                        if (id == "" || id == null) {
                            id = 0;
                        }

                        if (validaCamposIncidenciaIncidenciaEquipo()) {
                            axios.post("/limpieza/guardaIncidencias", {
                                Id: parseInt(id), CedulaLimpiezaId: @Model.Id, FechaIncidencia: fecha, Comentarios: comentarios, Pregunta: parseInt(pregunta),
                                Incidencia: { Tipo: tipo, Nombre: area }
                            }).then(response => {
                                if (response.status == 200) {
                                    if (id != 0) {
                                        html = "actualizada";
                                    } else {
                                        html = "registrada";
                                    }
                                    Swal.fire({
                                        'icon': "success",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': "La incidencia presentada en las actividades de Maquinaria y Equipo fue "+html+" de forma correcta."
                                    });
                                    guardaCedula();
                                    axios.get("/limpieza/getIncidencias", { params: { cedulaId: parseInt(@Model.Id) } }).then(response => {
                                        $('#tIncidencias').html(response.data);
                                    });
                                    $('#cerrar_modal').trigger('click');
                                    $('#id_incidencia').val("");
                                    $('#fecha_inciEquipo').val("");
                                    $('#tipo_incidencia').val("");
                                    $('#area_inciEquipo').val("");
                                    $('#comentarios_inciEquipo').val("");
                                    $('#fecha_inciEquipo').removeClass('is-valid');
                                    $('#area_inciEquipo').removeClass('is-valid');
                                    $('#comentarios_inciEquipo').removeClass('is-valid');
                                }
                            });
                        }
                    });
                /*Fin de Guarda la Incidencia*/

                /* Quita errores EQUIPOS */
                    $('#fecha_inciEquipo').change(function () {
                        if ($(this).val() != "") {
                            $('#fecha_inciEquipo').removeClass('is-invalid');
                            $('#fecha_inciEquipo').addClass('is-valid');
                            $('#error_fechaIncidenciaEq').css('display', 'none');
                        } else {
                            $('#fecha_inciEquipo').addClass('is-invalid');
                            $('#error_fechaIncidenciaEq').css('display', 'block');
                        }
                    });

                    $('#area_inciEquipo').change(function () {
                        if ($(this).val() != "") {
                            $('#area_inciEquipo').removeClass('is-invalid');
                            $('#area_inciEquipo').addClass('is-valid');
                            $('#error_areaInciEq').css('display', 'none');
                        } else {
                            $('#area_inciEquipo').addClass('is-invalid');
                            $('#error_areaInciEq').css('display', 'block');
                        }
                     });

                    $('#comentarios_inciEquipo').change(function () {
                        if ($(this).val() != "") {
                            $('#comentarios_inciEquipo').removeClass('is-invalid');
                            $('#comentarios_inciEquipo').addClass('is-valid');
                            $('#error_comentariosInciEq').css('display', 'none');
                        } else {
                            $('#comentarios_inciEquipo').addClass('is-invalid');
                            $('#error_comentariosInciEq').css('display', 'block');
                        }
                    });

                /* FIN Quita errores EQUIPOS */

            /************************************** FIN INCIDENCIAS (EQUIPO) **************************************/

            /************************************** CARGA/EDICION ARCHIVOS **************************************/
                /*Modal para Adjuntar Archivos*/
                    $('.btn_addFile').click(function () {
                        $('#modal_evidencias').modal('show');
                    });
                /*FIN del modal para adjuntar archivos*/

                /*Adjunta Entregables*/
                    function validaCamposArchivo() {

                        if ($('#tipo_entregable').val() == "" && $('#customFile').val() == "") {
                            $('#tipo_entregable').addClass('is-invalid');
                            $('#error_tipoEntre').css('display', 'block');

                            $('#customFile').addClass('is-invalid');
                            $('#error_customFile').css('display', 'block');

                            return false;
                        }

                        if ($('#tipo_entregable').val() == "" ) {
                            $('#tipo_entregable').addClass('is-invalid');
                            $('#error_tipoEntre').css('display', 'block');

                            return false;
                        }

                        if ($('#customFile').val() == "") {

                            $('#customFile').addClass('is-invalid');
                            $('#error_customFile').css('display', 'block');

                            return false;
                        }

                        return true;
                    }
                    $("#customFile").on("change", function () {
                        var fileName = $(this).val().split("\\").pop();
                        var ext = fileName.split('.').pop();
                        if (ext == "pdf") {
                            $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                        } else {
                            Swal.fire({
                                'icon': 'error',
                                'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                'text': 'El archivo que intenta adjuntar no es válido. Favor de solo seleccionar archivos "PDF"'
                            });
                            $(".custom-file-label").text("Seleccionar Archivo");
                            document.getElementById('customFile').value = '';
                            if ($('#customFile').hasClass('is-valid')) {
                                $('#customFile').removeClass('is-valid');
                            }
                            $('#customFile').addClass('is-invalid');
                            $('#error_customFile').css('display', 'block');
                        }

                    });

                    $('#adjuntarArchivo').click(function () {
                        var formData = new FormData();
                        var folio = model.folio;
                        var file = document.getElementById('customFile').files[0];
                        var id = $('#file_id').val();
                        var tipo = $('#tipo_entregable').val();
                        var comentarios = $('#comentarios_entregable').val();

                        if (id.length > 0) {
                            id = parseInt(id);
                        } else {
                            id = 0;
                        }

                        formData.append("Id", id);
                        formData.append("CedulaLimpiezaId", model.id);
                        formData.append("Archivo", file);
                        formData.append("Folio", folio);
                        formData.append("Tipo", tipo);
                        formData.append("Comentarios", comentarios);

                        if (validaCamposArchivo()) {
                            if (id != 0) {
                                axios.post('/cedLimpieza/adjuntaEntregable', formData, {
                                    headers: { 'Content-Type': 'multipart/form-data' }

                                }).then(response => {
                                    $('#cerrar_modal_sua').trigger('click');
                                    /*Validamos la pregunta a la que se realizo el anexo de evidencia*/
                                    if (response.status == 200) {
                                        Swal.fire({
                                            'icon': "success",
                                            'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                            'text': 'Se adjuntó el entregable de forma correcta.'
                                        });
                                        $('#customFile').removeClass('is-valid');
                                        $('#comentarios_entregable').removeClass('is-valid');
                                        $('#tipo_entregable').removeClass('is-valid');
                                    }
                                    axios.get("/cedLimpieza/getEntregables/" + model.id).then(success => {
                                        if (success.data == null || success.data == "") {
                                            $('#tEntregables').html(success.data);
                                        }
                                        $('#tEntregables').html(success.data);
                                    });
                                }).catch(error => {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'text': 'Se presentó un error al intentar adjuntar el archivo.'
                                    });
                                });

                                document.getElementById('customFile').value = '';
                                $('#file_id').val("");
                                $(".custom-file-label").text("Seleccionar Archivo");
                                $('#tipo_entregable').val('');
                                $('#comentarios_entregable').val('');
                            } else {
                                axios.get('/cedLimpieza/buscaEntregable/' + model.id + '/' + tipo).then(exist => {
                                    if (exist.data == 0) {
                                        axios.post('/cedLimpieza/adjuntaEntregable', formData, {
                                            headers: { 'Content-Type': 'multipart/form-data' }

                                        }).then(response => {
                                            $('#cerrar_modal_sua').trigger('click');
                                            /*Validamos la pregunta a la que se realizo el anexo de evidencia*/
                                            if (response.status == 200) {
                                                Swal.fire({
                                                    'icon': "success",
                                                    'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                                    'text': 'Se adjuntó el entregable de forma correcta.'
                                                });
                                                $('#customFile').removeClass('is-valid');
                                                $('#comentarios_entregable').removeClass('is-valid');
                                                $('#tipo_entregable').removeClass('is-valid');
                                            }
                                            axios.get("/cedLimpieza/getEntregables/" + model.id).then(success => {
                                                if (success.data == null || success.data == "") {
                                                    $('#tEntregables').html(success.data);
                                                }
                                                $('#tEntregables').html(success.data);
                                            });
                                        }).catch(error => {
                                            Swal.fire({
                                                'icon': "error",
                                                'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                                'text': 'Se presentó un error al intentar adjuntar el entregable.'
                                            });
                                        });

                                        document.getElementById('customFile').value = '';
                                        $('#file_id').val("");
                                        $(".custom-file-label").text("Seleccionar Archivo");
                                        $('#tipo_entregable').val('');
                                        $('#comentarios_entregable').val('');
                                    } else {
                                        Swal.fire({
                                            'icon': "error",
                                            'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                            'text': 'Ya existe un mismo entregable con el tipo ' + tipo
                                        });
                                    }
                                }).catch(e => {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'text': 'Se presentó un error al intentar adjuntar el entregable.'
                                    });
                                });
                            }
                        }
                    });

                /*FIN Adjunta Entregables*/

                /* Listado de Entregables de la Cedula */
                    axios.get("/cedLimpieza/getEntregables/"+model.id).then(response => {
                        if (response.data == null || response.data == "") {
                            $('#tEntregables').html(response.data);
                        }
                        $('#tEntregables').html(response.data);
                    });
                /* Fin Listado de Entregables de la Cedula*/

                /*Editar Entregables*/
                    $(document).on("click", ".update_files", function () {
                        $('#modal_evidencias').modal('show');
                        var id = $(this).data('id');
                        var tipo = $(this).data('tipo');
                        var coments = $(this).data('coments');
                        var file = $(this).data('file');
                        $('#file_id').val(parseInt(id));
                        $(".custom-file-label").text(file);
                        $('#tipo_entregable').val(tipo);
                        $('#comentarios_entregable').val(coments);
                        $('#mes_correspondiente').prop('disabled', true);
                        $('#modal_evidencias').modal('show');
                    });
                /*FIN de editar Entregables*/

                /*Elimina entregables*/
                    $(document).on("click", ".delete_files", function () {
                        let id = $(this).data('id');
                        let tipo = $('#tipo_entregable option[value='+$(this).data('tipo')+']').text();

                        Swal.fire({
                            'icon': 'warning',
                            'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                            'html': '¿Está seguro de eliminar el archivo "<strong>'+tipo+'"</strong>?',
                            'confirmButtonColor': '#3085d6',
                            'cancelButtonColor': '#d33',
                            'confirmButtonText': 'Sí, eliminar archivo',
                            'cancelButtonText': 'Cancelar',
                            'showCancelButton': true
                        }).then(response => {
                            if (response.isConfirmed) {
                                axios.post("/cedLimpieza/eliminaArchivo", { Id: id, Folio: model.folio }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire(
                                            'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                            'El archivo fue eliminado con éxito.',
                                            'success'
                                        );
                                        axios.get("/cedLimpieza/getEntregables/" + model.id).then(response => {
                                            if (response.data == null || response.data == "") {
                                                $('#tEntregables').html(response.data);
                                            }
                                            $('#tEntregables').html(response.data);
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire(
                                        'Algo Falló',
                                        'No se pudo procesar tu solicitud. Contacta a tu Administrador.',
                                        'error'
                                    );
                                });
                            }
                        });
                    });
                /*FIN de elimina entregables*/

                /*Ver archivo en modal*/
                   $(document).on('click', '.view_file', function () {
                        let nombre = $(this).data('file');
                        let tipo = $(this).data('tipo');
                        let url = '<object class="objectPdf" width="100%" height="450" embedded=True data="' + '/cedLimpieza/verArchivo/' + model.folio + '/' + nombre + '"></object>';
                        $('#titlePDF').text("PDF - \"" + tipo + "\"");
                        $('#entregablePDF').html(url);
                        $('#modal_pdf').modal('show');
                    });
                /*FIN de ver archivo en modal*/

                /*Validaciones Entregables*/
                    $('#tipo_entregable').change(function () {
                        if ($('#tipo_entregable').val() == "") {
                            $('#tipo_entregable').addClass('is-invalid');
                            $('#error_tipoEntre').css('display', 'block');

                            return false;
                        } else {
                            $('#tipo_entregable').removeClass('is-invalid');
                            $('#tipo_entregable').addClass('is-valid');
                            $('#error_tipoEntre').css('display', 'none');
                        }
                    });

                    $('#customFile').change(function () {
                         if ($('#customFile').val() == "") {
                             $('#customFile').addClass('is-invalid');
                             $('#error_customFile').css('display', 'block');

                        } else {
                             var fileName = $("#customFile").val().split("\\").pop();
                             var ext = fileName.split('.').pop();
                             if (ext != "pdf") {
                                 $('#customFile').addClass('is-invalid');
                                 $('#error_customFile').css('display', 'block');
                             } else {
                                 $('#customFile').removeClass('is-invalid');
                                 $('#customFile').addClass('is-valid');
                                 $('#error_customFile').css('display', 'none');
                             }
                        }
                     });

                    $('#comentarios_entregable').change(function () {
                        if ($('#comentarios_entregable').val() == "") {
                            $('#comentarios_entregable').addClass('is-invalid');
                            $('#error_comentariosEntre').css('display', 'block');

                            return false;
                        } else {
                            $('#comentarios_entregable').removeClass('is-invalid');
                            $('#comentarios_entregable').addClass('is-valid');
                            $('#error_comentariosEntre').css('display', 'none');
                        }
                    });
                /*FIN de Validaciones Entregables*/

                /************************************ FIN CARGA/EDICION ARCHIVOS ************************************/

            /************************************ GUARDAR/ENVIAR Cédula ************************************/
                /*Guardar la Cedula*/
                    $('.btn_guardar').click(function () {
                    var respuestas = new Array();
                    for (let i = 0; i < 7; i++) {
                        let type = document.getElementsByClassName("pregunta" + (i + 1))[0];
                        let respuesta = $("input[name=pregunta" + (i + 1) + "]:checked").val();
                        if(respuesta != null || type.getAttribute("type") == "date"){
                            if((i+1) == 1 || (i+1) == 5 || (i+1) == 6 || (i+1) == 7){
                                let detalles = $('#detalle' + (i + 1)).val();
                                if (respuesta == "false" && (i + 1) == 6) {
                                    detalles = $('#comentarios_sua').val();
                                } else if (respuesta == "true" && (i + 1) == 6) {
                                    detalles = $('#detalle' + (i + 1)).val() + "|" + $('#mes_correspondiente').val();
                                } else if (respuesta == "false" && (i + 1) == 7) {
                                    detalles = $('#comentarios_acta').val();
                                }
                                respuestas.push({ CedulaLimpiezaId: parseInt(model.id), Pregunta: (i + 1), Respuesta: (respuesta == "true"), Detalles: detalles});
                            } else {
                                respuestas.push({ CedulaLimpiezaId: parseInt(model.id), Pregunta: (i + 1), Respuesta: (respuesta == "true"), Detalles: null });
                            }
                        }
                    }

                    axios.post("/cedLimpieza/evaluation", respuestas).then(response => {
                        if (response.status == 200) {
                            Swal.fire({
                                'icon': "success",
                                'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                'html': "Se guardaron las respuestas de la cédula correctamente."
                            });
                        } else {
                            Swal.fire({
                                'icon': "error",
                                'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                'html': "Hubo un error al guardar la(s) respuesta(s) de la cédula. Contacte al Administrador del Sistema"
                            });
                        }
                    });
                });
                /*FIN de guardar la cedula*/

                /*Guardar la Cedula sin mensaje*/
                function guardaCedula() {
                    var respuestas = new Array();
                    for (let i = 0; i < 7; i++) {
                        let type = document.getElementsByClassName("pregunta" + (i + 1))[0];
                        let respuesta = $("input[name=pregunta" + (i + 1) + "]:checked").val();
                        if (respuesta != null || type.getAttribute("type") == "date") {
                            if ((i + 1) == 1 || (i + 1) == 5 || (i + 1) == 6 || (i + 1) == 7) {
                                let detalles = $('#detalle' + (i + 1)).val();
                                if (respuesta == "false" && (i + 1) == 6) {
                                    detalles = $('#comentarios_sua').val();
                                } else if (respuesta == "true" && (i + 1) == 6) {
                                    detalles = $('#detalle' + (i + 1)).val() + "|" + $('#mes_correspondiente').val();
                                } else if (respuesta == "false" && (i + 1) == 7) {
                                    detalles = $('#comentarios_acta').val();
                                }
                                respuestas.push({ CedulaLimpiezaId: parseInt(model.id), Pregunta: (i + 1), Respuesta: (respuesta == "true"), Detalles: detalles });
                            } else {
                                respuestas.push({ CedulaLimpiezaId: parseInt(model.id), Pregunta: (i + 1), Respuesta: (respuesta == "true"), Detalles: null });
                            }
                        }
                    }

                    axios.post("/cedLimpieza/evaluation", respuestas).then(response => {
                        if (response.status == 200) {

                        } else {
                            Swal.fire({
                                'icon': "error",
                                'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                'html': "Hubo un error al guardar las respuestas de la cédula. Contacte al Administrador del Sistema"
                            });
                        }
                    });
                }
                /*FIN de guardar la cedula*/

                /*Validamos que ya fueron adjuntados todos los entregables*/
                function validaEntregables() {
                    var msgEntregables = ["Acta Entrega-Recepción", "Factura", "Validación del SAT"];
                    var entregables = ["ActaER", "Factura", "SAT"];
                    var msg = "";
                    var nota = false;
                    var found = false;
                    axios.get('/cedLimpieza/getListadoEntregablesLimpieza/' + model.id).then(response => {
                        for (var j = 0; j < entregables.length; j++) {
                            for (var i = 0; i < response.data.length; i++) {
                                if (entregables[j] == response.data[i].tipo) {
                                    found = true;
                                    break;
                                } else {
                                    found = false;
                                }
                            }
                            if (!found) {
                                msg += "<strong> - "+msgEntregables[j]+"<br/></strong>";
                            }
                        }

                        for (var i = 0; i < response.data.length; i++) {
                            if ("NotaCredito" == response.data[i].tipo) {
                                nota = true;
                                break;
                            }
                        }

                        if (parseInt($('#detalle5').val()) > 0 && nota == false) {
                            msg += "<strong> - Nota(s) de Crédito <br/></strong>";
                        }
                        if (msg != "") {
                            Swal.fire({
                                'icon': 'error',
                                'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                'html': 'Para enviar la cédula a la DAS, es necesario adjuntar los siguientes entregables: <br/><br/>' + msg
                            });
                            return false;
                        } else {
                            axios.post("/cedLimpieza/sendCedula/"+model.id).then(response => {
                                if (response.status == 200) {
                                    Swal.fire({
                                        'icon': "success",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': "Se envió la cédula para su revisión correctamente."
                                    }).then(function () {
                                        window.location.href = "/limpieza/index";
                                    });
                                } else {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': "Hubo un error al guardar las respuestas de la cédula. Contacte al Administrador del Sistema"
                                    });
                                }
                            });
                        }
                    });
                }

                /*FIN Validamos que ya fueron adjuntados todos los entregables*/

                /*Enviar la Cedula*/
                    $('.btn_enviar').click(function () {
                        var respuestas = new Array();
                        var nota = false;
                        if (model.facturas.length == 0) {
                            Swal.fire({
                                'icon': 'error',
                                'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                'html': 'No ha registrado ninguna factura en la cédula'
                            });
                            return false;
                        }



                        guardaCedula();

                        for (let i = 0; i < 7; i++) {
                            let type = document.getElementsByClassName("pregunta" + (i + 1))[0];
                            let respuesta = $("input[name=pregunta" + (i + 1) + "]:checked").val();
                            if (respuesta != null || type.getAttribute("type") == "date") {
                                if ((i + 1) == 1 || (i + 1) == 5 || (i + 1) == 6 || (i + 1) == 7) {
                                    let detalles = $('#detalle' + (i + 1)).val();

                                    if (respuesta == "false" && (i + 1) == 6) {
                                        detalles = $('#comentarios_sua').val();
                                    } else if (respuesta == "false" && (i + 1) == 7) {
                                        detalles = $('#comentarios_acta').val();
                                    }
                                    respuestas.push({ CedulaLimpiezaId: model.id, Pregunta: (i + 1), Respuesta: (respuesta == "true"), Detalles: detalles, MontoPenalizacion: model.montoFactura });
                                } else {
                                    respuestas.push({ CedulaLimpiezaId: model.id, Pregunta: (i + 1), Respuesta: (respuesta == "true"), Detalles: null, MontoPenalizacion: model.montoFactura });
                                }
                            } else {
                                Swal.fire({
                                    'icon': 'error',
                                    'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                    'html': 'La <strong>"Pregunta ' + (i + 1) +'"</strong> no se ha contestado. Favor de revisar.'
                                });
                                break;
                            }
                        }

                        /*Validamos que ya hayan capturado las incidencias*/
                            if (String(respuestas[1].Respuesta) == "false" ) {
                                axios.get("/limpieza/getIncidencias",{ params: { cedulaId: parseInt(@Model.Id) } }).then(response => {
                                    if (response.data.length == 0) {
                                        Swal.fire({
                                            'icon': "error",
                                            'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                            'html': 'Las incidencias en la <strong>"Pregunta 2"</strong> no se han capturado. Favor de revisar.'
                                        });
                                        return false;
                                    }
                                });
                            }

                            if (String(respuestas[3].Respuesta) == "false" ) {
                                axios.get("/limpieza/getIncidenciasEquipo", { params: { cedulaId: parseInt(@Model.Id) } }).then(response => {
                                    if (response.data.length == 0) {
                                        Swal.fire({
                                            'icon': "error",
                                            'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                            'html': 'Las incidencias en la <strong>"Pregunta 4"</strong> no se han capturado. Favor de revisar.'
                                        });
                                        return false;
                                    }
                                });
                            }

                            if (String(respuestas[4].Respuesta) == "true") {
                                if ($('#detalle5').val() == "" || parseInt($('#detalle5').val()) <= 0) {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': 'Las <strong>"Inasistencias"</strong> en la <strong>"Pregunta 5"</strong> no se han capturado, son valores "Negativos" o iguales a cero. Favor de revisar.'
                                    });
                                    return false;
                                }
                                for (let i = 0; i < model.facturas.length; i++) {
                                    if (model.facturas[i].receptor.usoCFDI == "G02") {
                                        nota = true
                                        break;
                                    }
                                }
                                if (nota == false) {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': 'No ha adjuntado el XML de la Nota de Crédito. Favor de revisar.'
                                    });
                                    return false;
                                }
                            }

                            if (String(respuestas[5].Respuesta) == "true") {
                                if ($('#detalle6').val() == "" && $('#mes_correspondiente').val() == "") {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': 'La <strong>"Fecha de Entrega del SUA"</strong> y él <strong>"Mes Correspondiente"</strong> en la <strong>"Pregunta 6"<strong> no han sido capturados. Favor de revisar.'
                                    });
                                    return false;
                                }

                                if ($('#detalle6').val() == "") {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': 'La <strong>"Fecha de Entrega del SUA"</strong> en la <strong>"Pregunta 6"<strong> no ha sido capturada. Favor de revisar.'
                                    });
                                    return false;
                                }

                                if ($('#mes_correspondiente').val() == "") {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': 'El <strong>"Mes Correspondiente"</strong> en la <strong>"Pregunta 6"<strong> no ha sido capturado. Favor de revisar.'
                                    });
                                    return false;
                                }
                            }

                                if (String(respuestas[6].Respuesta) == "true") {
                                    if ($('#detalle7').val() == "") {
                                        Swal.fire({
                                            'icon': "error",
                                            'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                            'html': 'La <strong>"Fecha de Entrega del Acta Entrega-Recepción"</strong> en la <strong>"Pregunta 7"<strong> no ha sido capturada. Favor de revisar.'
                                        });
                                        return false;
                                    }
                                } else if ($('#comentarios_acta').val() == "") {
                                    Swal.fire({
                                        'icon': "error",
                                        'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                        'html': 'Los <strong>"Comentarios de la Entrega del Acta Entrega-Recepción"</strong> en la <strong>"Pregunta 7"</strong> no han sido capturados. Favor de revisar.'
                                    });
                                    return false;

                                }

                        validaEntregables();
                    });

                $(".revisar_cedula").click(function () {
                        let pregunta = 8;
                        let respuesta = $("input[name=pregunta8]:checked").val();
                        if (respuesta == "" || respuesta == null) {
                            Swal.fire({
                                'icon': 'error',
                                'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                'html': 'Para continuar, capture si el personal está capacitado debídamente para prestar el servicio.'
                            });
                            return false;
                        } else {
                            respuestas.push({ CedulaLimpiezaId: parseInt(model.id), Pregunta: pregunta, Respuesta: (respuesta == "true"), Detalles: "Capacitación" });
                            axios.post("/cedLimpieza/evaluation", respuestas).then(response => {
                                if (response.status == 200) {
                                    axios.post("/cedLimpieza/sendCedula/" + model.id).then(response => {
                                        Swal.fire({
                                            'icon': "success",
                                            'title': 'Servicio de Limpieza en Áreas Comunes y Oficinas',
                                            'html': "Se guardaron las respuestas de la cédula correctamente."
                                        }).then(function () {
                                            window.location.href = "/limpieza/revision/" + model.id;
                                        });
                                    });
                                }
                            });
                        }
                    });
                /*Enviar de guardar la cedula*/

            /********************************** FIN GUARDAR/ENVIAR CÉDULA **********************************/
        }
    </script>
}

