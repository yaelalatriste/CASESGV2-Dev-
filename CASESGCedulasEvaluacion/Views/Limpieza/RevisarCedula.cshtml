@model CedulasEvaluacion.Entities.Models.CedulaLimpieza
@{
    var title = TempData["Title"] as string;
    ViewData["Title"] = "Revisión de la Cédula del Servicio de Limpieza en Áreas Comunes y Oficinas con Folio: " + Model.Folio;
}

<div class="row col-lg-12">
    <div class="col-lg-12">
        <a href="/limpieza/index" type='button' class='btn-sm btn-warning float-right mr-2 mb-3'><i class="fal fa-arrow-left"></i></a>
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <ul class="nav nav-tabs h6" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#informacion_general" role="tab" aria-controls="home" aria-selected="true">Información General</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#actividades_contempladas" role="tab" aria-controls="contact" aria-selected="false">Actividades Contempladas</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#uniforme" role="tab" aria-controls="contact" aria-selected="false">Uniforme</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#maquinariaEquipo" role="tab" aria-controls="contact" aria-selected="false">Maquinaria y Equipo</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#sua" role="tab" aria-controls="contact" aria-selected="false">Comprobantes de Pago (SUA)</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#entregables_cedula" role="tab" aria-controls="contact" aria-selected="false">Entregables</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#capacitacion_personal" role="tab" aria-controls="contact" aria-selected="false">Capacitación</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#historial_cedula" role="tab" aria-controls="contact" aria-selected="false">Seguimiento a Cédula</a>
            </li>
        </ul>
        @{ int ti = 0;}
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="informacion_general" role="tabpanel" aria-labelledby="home-tab">
                <div class="row justify-content-center align-items-center mt-4">
                    <div class="col-lg-12 h3 ml-4">
                        Información General
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 mt-3">
                        <div class="card bg-light d-flex flex-fill">
                            <div class="card-header border-bottom-0">
                                <h2 class="lead"><b>Inmueble Evaluado: </b> @Model.inmuebles.Nombre</h2>
                            </div>
                            <div class="card-body pt-0">
                                <div class="row">
                                    <div class="col-7">
                                        <h2 class="lead">
                                            <strong>
                                                Factura Capturadas:
                                            </strong>
                                            <a href="#" id="btn_facturas" class='btn btn-sm btn-facturas ml-2 mb-1' data-toggle="tooltip" title="Ver Facturas" data-placement="top">
                                                <i class="fal fa-file-invoice"></i>
                                            </a>
                                        </h2>
                                        <p class="text-sm">Evaluación correspondiente al mes <b>@Model.Mes</b> del año <b>@Model.Anio</b></p>
                                        <ul class="ml-4 mb-0 fa-ul">
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-dollar-sign"></i></span> <b>Facturación Total: </b>: @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", Model.TotalMontoFactura)</li>
                                            @if (Model.RespuestasEncuesta[4].Respuesta == true)
                                            {
                                                <li class="small mt-3"><span class="fa-li"><i class="fad fa-user"></i></span> <b>Inasistencias: </b> @Model.RespuestasEncuesta[4].Detalles</li>
                                            }
                                            else
                                            {
                                                <li class="small mt-3"><span class="fa-li"><i class="fad fa-user"></i></span> <b>Sin Inasistencias </b></li>
                                            }
                                            </li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fad fa-star"></i></span> <b>Calificación: </b> @Model.Calificacion</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-lg fa-user"></i></span> <b>Elaboró: </b> @Model.usuarios.nombre_emp @Model.usuarios.paterno_emp @Model.usuarios.materno_emp</li>
                                            <li class="small mt-3">
                                                <span class="fa-li"><i class="fas fa-lg fa-envelope mb-1"></i></span>
                                                <strong>Correo:</strong>
                                                @if (@Model.usuarios.correo_electronico.Equals("") || @Model.usuarios.correo_electronico.Equals(null))
                                                {
                                                    <strong class="text-danger">@String.Format("Sin correo")</strong>
                                                }
                                                else
                                                {
                                                    @Model.usuarios.correo_electronico
                                                }
                                                <a href="#" id="btn_correo" class='btn-xs btn-primary ml-2' data-toggle="tooltip" title="Actualizar Correo Electrónico" data-placement="top">
                                                    <i class="fal fa-edit"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-5">
                                        @if (@Model.Estatus.Equals("Enviado a DAS"))
                                        {
                                            <h5 class="text-enviadoDAS lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        else if (@Model.Estatus.Equals("Revisión CAE"))
                                        {
                                            <h5 class="text-primary lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        else if (@Model.Estatus.Equals("En Trámite"))
                                        {
                                            <h5 class="text-info lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        else if (@Model.Estatus.Equals("Rechazada"))
                                        {
                                            <h5 class="text-danger lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        else if (@Model.Estatus.Equals("Trámite Rechazado"))
                                        {
                                            <h5 class="text-tramiteRechazado lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        else if (@Model.Estatus.Equals("Autorizada"))
                                        {
                                            <h5 class="text-autorizado lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        else if (@Model.Estatus.Equals("Autorizado CAE"))
                                        {
                                            <h5 class="text-autorizadoCAE lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        else if (@Model.Estatus.Equals("Trámite de Pago"))
                                        {
                                            <h5 class="text-tramitePago lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        else if (@Model.Estatus.Equals("Enviada a DGPPT"))
                                        {
                                            <h5 class="text-dgppt lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        else if (@Model.Estatus.Equals("Pagada"))
                                        {
                                            <h5 class="text-success lblEstatus"><strong>Estatus: </strong> @Model.Estatus</h5>
                                        }
                                        <p class="text-sm">
                                            @{decimal total = Convert.ToDecimal(@Model.RespuestasEncuesta[0].MontoPenalizacion + @Model.RespuestasEncuesta[1].MontoPenalizacion +
                                                          @Model.RespuestasEncuesta[2].MontoPenalizacion + @Model.RespuestasEncuesta[3].MontoPenalizacion
                                                          + Model.PenaCalificacion + Model.capacitacion.MontoPenalizacion + Model.TotalBajoDemanda);
                                            }
                                            @if (total > 0)
                                            {
                                                <h5 class="text-danger">
                                                    <b>Total Penalizable:</b> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", total)
                                                </h5>
                                            }
                                            else
                                            {
                                                <h5 class="text-success">
                                                    <b>No hay Monto Penalizable</b>
                                                </h5>
                                            }
                                        </p>
                                        <ul class="ml-4 mb-0 fa-ul">
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-tools"></i></span> <b>Actividades: </b>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[1].MontoPenalizacion)</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-tools"></i></span> <b>Uniforme: </b>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[2].MontoPenalizacion)</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-tools"></i></span> <b>Actividades en Equipo: </b>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[3].MontoPenalizacion)</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-tools"></i></span> <b>Entregables Bajo Demanda: </b>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.TotalBajoDemanda)</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fal fa-head-side-brain"></i></span> <b>Capacitación de Personal: </b>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.capacitacion.MontoPenalizacion)</li>
                                            <li class="small mt-3"><span class="fa-li"><i class="fas fa-star"></i></span> <b> Calificación: </b>@String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.PenaCalificacion)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            @if (Model.Estatus.Equals("Enviado a DAS"))
                            {
                                <div class="card-footer">
                                    <div class="text-right">
                                        <button href="" class="btn btn-danger float-right mr-3 failed_cedula"><i class="fas fa-times mr-2"></i>Rechazar Cédula</button>
                                        <button href="" class="btn btn-success float-right mr-3 success_cedula"><i class="fas fa-check mr-2"></i>Aceptar Cédula</button>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="actividades_contempladas" role="tabpanel" aria-labelledby="contact-tab">
                <div class="col-lg-12 h3 mt-4">
                    Actividades Contempladas
                </div>
                @if (@Model.incidencias.Count > 0)
                {
                    <div class="row mt-4">
                        <div class="row col-lg-12 mt-3">
                            <p class="h5 text-justify text-danger ml-3">El prestador de servicios no cumplió con las actividades del "Programa de Operación", siendo acreedor a una penalización.</p>
                            <div class="col-lg-9 mt-3 ml-4">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Nombre</th>
                                            <th>Tipo</th>
                                            <th>Comentarios</th>
                                            <th>Fecha de la Incidencia</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var inci in @Model.incidencias)
                                        {
                                            ti++;
                                            <tr>
                                                <td>@inci.Nombre</td>
                                                <td>@inci.Tipo</td>
                                                <td>@inci.Comentarios</td>
                                                <td>@inci.FechaIncidencia.ToString("yyyy-MM-dd")</td>
                                            </tr>
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <th colspan="3" class="text-right">Total de Incidencias:</th>
                                            <th class="text-center">@ti</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <h5 class="text-danger ml-4">
                                <strong>Total de Incidencias: </strong> @Model.incidencias.Count
                            </h5>
                            <h5 class="text-danger ml-4">
                                <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[1].MontoPenalizacion)
                            </h5>
                        </div>
                    </div>
                }
                else
                {
                    <div class="row mt-4">
                        <div class="row col-lg-12 mt-3">
                            <div class="col-lg-9 mt-3 ml-4">
                                <p class="h3 text-justify text-success">El prestador de servicios cumplió con las actividades contempladas y no presentó incidencias en el mes, evitando la(s) penalizaciones correspondientes.</p>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-check-circle text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <h5 class="text-success ml-4">
                                <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[1].MontoPenalizacion)
                            </h5>
                        </div>
                    </div>
                }
            </div>
            <div class="tab-pane fade" id="uniforme" role="tabpanel" aria-labelledby="profile-tab">
                <div class="col-lg-12 h3 mt-4">
                    Uniforme y Gafete
                </div>
                @if (@Model.RespuestasEncuesta[2].Penalizable == true)
                {
                    <div class="row mt-4">
                        <div class="row col-lg-12 mt-3">
                            <div class="col-lg-9 mt-3 ml-4">
                                <p class="h3 text-justify text-danger">El prestador de servicios no portó el uniforme y gafete correspondientes siendo acreedor a una penalización.</p>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <h5 class="text-danger ml-4">
                                <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[2].MontoPenalizacion)
                            </h5>
                        </div>
                    </div>
                }
                else
                {
                    <div class="row mt-4">
                        <div class="row col-lg-12 mt-3">
                            <div class="col-lg-9 mt-3 ml-4">
                                <p class="h3 text-justify text-success">El prestador de servicios portó el uniforme y gafete correspondientes evitando una penalización en el mes correspondiente.</p>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-check-circle text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <h5 class="text-success ml-4">
                                <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[2].MontoPenalizacion)
                            </h5>
                        </div>
                    </div>
                }
            </div>
            <div class="tab-pane fade" id="maquinariaEquipo" role="tabpanel" aria-labelledby="profile-tab">
                <div class="col-lg-12 h3 mt-4">
                    Maquinaria y Equipo
                </div>
                @if (@Model.iEquipos.Count > 0)
                {
                    ti = 0;
                    <div class="row mt-4">
                        <div class="row col-lg-12 mt-3">
                            <p class="h5 text-justify text-danger ml-3">El prestador de servicios no cumplió con las actividades de "Maquinaria y Equipo", siendo acreedor a una penalización.</p>
                            <div class="col-lg-9 mt-3 ml-4">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Nombre</th>
                                            <th>Tipo</th>
                                            <th>Comentarios</th>
                                            <th>Fecha de la Incidencia</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var inci in @Model.iEquipos)
                                        {
                                            <tr>
                                                <td>@inci.Nombre</td>
                                                <td>@inci.Tipo</td>
                                                <td>@inci.Comentarios</td>
                                                <td>@inci.FechaIncidencia.ToString("yyyy-MM-dd")</td>
                                            </tr>
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <th colspan="3" class="text-right">Total de Incidencias:</th>
                                            <th class="text-center">@ti</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <h5 class="text-danger ml-4">
                                <strong>Total de Incidencias: </strong> @Model.iEquipos.Count
                            </h5>
                            <h5 class="text-danger ml-4">
                                <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[3].MontoPenalizacion)
                            </h5>
                        </div>
                    </div>
                }
                else
                {
                    <div class="row mt-4">
                        <div class="row col-lg-12 mt-3">
                            <div class="col-lg-9 mt-3 ml-4">
                                <p class="h3 text-justify text-success">El prestador de servicios cumplió con las actividades contempladas y no presento incidencias en el mes, evitando la(s) penalizaciones correspondientes.</p>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-check-circle text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <h5 class="text-success ml-4">
                                <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[3].MontoPenalizacion)
                            </h5>
                        </div>
                    </div>
                }
            </div>
            <div class="tab-pane fade" id="capacitacion_personal" role="tabpanel" aria-labelledby="contact-tab">
                <div class="col-lg-12 h3 mt-4">
                    Capacitación de Personal
                </div>
                @if (@Model.RespuestasEncuesta[7].Respuesta == false)
                {
                    <div class="row mt-5">
                        <div class="row col-lg-12 mt-3">
                            <div class="col-lg-9 mt-3 ml-4">
                                <p class="h3 text-justify text-danger">El prestador de servicios no cuenta con el personal capacitado para realizar el servicio, siendo acreedor a una penalización.</p>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <h5 class="text-danger ml-4">
                                <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[7].MontoPenalizacion)
                            </h5>
                        </div>
                    </div>
                }
                else
                {
                    <div class="row mt-5">
                        <div class="row col-lg-12 mt-3">
                            <div class="col-lg-9 mt-3 ml-4">
                                <p class="h3 text-justify text-success">El prestador de servicios capacitó a su personal de forma correcta evitando la penalización correspondiente.</p>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-check-circle text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                @* Fin de la Pregunta de Capacitación *@
            </div>
            <div class="tab-pane fade" id="sua" role="tabpanel" aria-labelledby="profile-tab">
                <div class="col-lg-12 h3 mt-4">
                    Comprobantes de Pago y SUA
                </div>
                @if (@Model.RespuestasEncuesta[5].Respuesta == false)
                {
                    <div class="row mt-4">
                        <div class="row col-lg-12 mt-3">
                            <div class="col-lg-9 mt-3 ml-4">
                                <p class="h3 text-justify text-danger">El prestador de servicios no entregó los comprobantes de pago y SUA correspondientes, siendo acreedor a una penalización.</p>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-times-circle text-danger"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <h5 class="text-danger ml-4">
                                <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[2].MontoPenalizacion)
                            </h5>
                        </div>
                    </div>
                }
                else
                {
                    <div class="row mt-4">
                        <div class="row col-lg-12 mt-3">
                            <div class="col-lg-9 mt-3 ml-4">
                                <p class='h3 text-justify text-success'>El prestador de servicios entregó los comprobantes de pago y SUA en la fecha @System.Convert.ToDateTime(@Model.RespuestasEncuesta[5].Detalles.Split("|")[0]).ToString("dd/MM/yyyy") correspondiente al mes de @Model.RespuestasEncuesta[5].Detalles.Split("|")[1].</p>
                            </div>
                            <div class="col-lg-2" style="margin-top: -18px;">
                                <div class="small-box bg-warning">
                                    <div class="icon">
                                        <i class="fas fa-check-circle text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-lg-12">
                            <h5 class="text-success ml-4">
                                <strong>Penalización: </strong> @String.Format(System.Globalization.CultureInfo.CurrentCulture, "{0:C}", @Model.RespuestasEncuesta[2].MontoPenalizacion)
                            </h5>
                        </div>
                    </div>
                }
            </div>
            <div class="tab-pane fade" id="entregables_cedula" role="tabpanel" aria-labelledby="contact-tab">
                <div class="col-lg-12 mt-3">
                    <ul class="nav nav-tabs h6" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#entregables_periodicos" role="tab" aria-controls="home" aria-selected="true">Entregables Períodicos</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#entregables_bd" role="tab" aria-controls="contact" aria-selected="false">Entregables Bajo Demanda</a>
                        </li>
                    </ul>
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="entregables_periodicos" role="tabpanel" aria-labelledby="home-tab">
                            <div class="col-lg-12 h3 mt-4">
                                Entregables Períodicos
                            </div>

                            <div class="row col-lg-12">
                                <div class="col-lg-8">
                                    <p class="h6">El usuario adjunto los siguientes entregables.</p>
                                </div>
                            </div>
                            <div class="row col-lg-12 mt-2 h6">
                                <div class="col-lg-12">
                                    <h6 class="mt-4"><strong>Entregables Adjuntos</strong></h6>
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Tipo</th>
                                                <th>Nombre</th>
                                                <th>Fecha de Carga</th>
                                                <th>Ver</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var entre in @Model.iEntregables)
                                            {
                                                <tr>
                                                    @if (entre.Tipo.Equals("ActaER"))
                                                    {
                                                        <td>Acta Entrega - Recepción</td>
                                                    }
                                                    else if (entre.Tipo.Equals("Factura"))
                                                    {
                                                        <td>Factura</td>
                                                    }
                                                    else if (entre.Tipo.Equals("SAT"))
                                                    {
                                                        <td>Validación del SAT</td>
                                                    }
                                                    else if (entre.Tipo.Equals("NotaCredito"))
                                                    {
                                                        <td>Nota de Crédito</td>
                                                    }
                                                    else if (entre.Tipo.Equals("Reporte(s)"))
                                                    {
                                                        <td>Reporte(s)</td>
                                                    }
                                                    else if (entre.Tipo.Equals("Cedula_Firmada"))
                                                    {
                                                        <td>Cédula Firmada</td>
                                                    }
                                                    else if (entre.Tipo.Equals("Memorandum"))
                                                    {
                                                        <td>Memorándum</td>
                                                    }
                                                    <td>@entre.NombreArchivo</td>
                                                    <td>@entre.FechaCreacion.ToString("yyyy-MM-dd")</td>
                                                    <td>
                                                        <a href='#' class='text-center mr-2 view_file' data-id="@entre.Id" data-file="@entre.NombreArchivo" data-tipo="@entre.Tipo">
                                                            <i class='fas fa-eye text-success'></i>
                                                        </a>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div id="entregables_bd" class="tab-pane fade" role="tabpanel" aria-labelledby="home-tab">
                            <div class="col-lg-12 h3 mt-4">
                                Entregables Bajo Demanda
                            </div>

                            <div class="row">
                                <div class="col-lg-12 ml-3 mt-2">
                                    <p class="text-black h5 mb-3">¿Se solicitaron entregables bajo demanda durante el periodo de evaluación correspondiente a <strong>@Model.Mes @Model.Anio</strong>?</p>
                                    <div class="icheck-success d-inline">
                                        <input type="radio" name="entregablesBajoD" value="true" id="radioSuccess3" class="entregablesBajoD">
                                        <label for="radioSuccess3">Si</label>
                                    </div>
                                    <div class="icheck-success d-inline ml-3">
                                        <input type="radio" name="entregablesBajoD" value="false" id="radioSuccess4" class="entregablesBajoD">
                                        <label for="radioSuccess4">No</label>
                                    </div>
                                </div>
                                <div class="col-lg-12 mb-4">
                                    <button type="button" class="btn btn-md btn-success float-right" id="btnEntregables">Guardar Respuesta</button>
                                </div>
                            </div>
                            <div class="row" id="listado_entregablesBD">
                                <div class="col-lg-12 mb-3">
                                    <button type='button' class='btn btn-primary mr-2' id="btn_entregableBD"><i class="fas fa-plus"></i></button>
                                </div>
                                <div class="col-lg-12">
                                    <table class="table table-responsive-xl">
                                        <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Fecha de Entrega</th>
                                                <th>Fecha Limite</th>
                                                <th>Penalizable</th>
                                                <th>Penalización</th>
                                                <th>Ver</th>
                                            </tr>
                                        </thead>
                                        <tbody id="list_entregablesBD"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="historial_cedula" role="tabpanel" aria-labelledby="contact-tab">
                <div class="row justify-content-center align-items-center mt-4">
                    <div class="col-lg-12 h3 ml-4">
                        Seguimiento de la Cédula
                    </div>
                    <div class="row col-lg-12">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Servicio</th>
                                    <th>Usuario</th>
                                    <th>Comentarios</th>
                                    <th>Estatus</th>
                                    <th>Fecha de Actualización</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var hist in @Model.historialCedulas)
                                {
                                    <tr>
                                        <td>@hist.Servicio</td>
                                        <td>@hist.usuarios.nombre_emp @hist.usuarios.paterno_emp @hist.usuarios.materno_emp</td>
                                        <td>@hist.Comentarios</td>
                                        <td>@hist.Estatus</td>
                                        <td>@hist.FechaCreacion</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@* Modal para ver las facturas de la cedula *@
<div class="modal fade" id="modal-ver-facturas">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Factura Capturadas</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12 mt-3">
                        <table class="table table-responsive" id="listado_facturas">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Empresa</th>
                                    <th>Folio Fiscal</th>
                                    <th>Numero de la Factura</th>
                                    <th>Subtotal de la Factura</th>
                                    <th>Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="listaFacturas"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@* FIN del Modal para ver las facturas de la cedula *@

@* Modal para ver los conceptos de las facturas de la cedula *@
<div class="modal fade" id="modal-ver-conceptos">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white" id="factura_serie"></h4>
                <button type="button" class="close close_conceptos text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class=" row col-lg-12" id="detalle_conceptos"></div>
            </div>
        </div>
    </div>
    <!-- /.modal-content -->
</div>
<!-- /.modal-dialog -->
@* Fin de Modal para ver los conceptos de las facturas de la cedula *@

@* Modal para la captura de Adjuntos *@
<div class="modal fade" id="modal_entregablesBD">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Adjuntar Entregables</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <input type="hidden" id="file_id" />
                    <div class="form-group col-lg-6">
                        <label for="elegirArchivo">Seleccionar Archivo: </label>
                        <div class="custom-file">
                            <input type="file" class="custom-file-input" id="customFile" accept=".pdf">
                            <label class="custom-file-label" for="customFile">Seleccionar Archivo</label>
                        </div>
                        <div class="col-sm-12" id="error_customFile">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione él archivo correspondiente
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-lg-3">
                        <div class="fechaEntrega">
                            <label for="forFechaEntrega">Fecha Entrega: </label>
                            <input class="form-control" type="date" id="fecha_entrega" />
                        </div>
                        <div class="col-sm-12" id="error_fechaEntrega">
                            <small id="fechaEntregaHelp" class="text-danger is-valid">
                                Por favor seleccione la fecha de entrega correspondiente
                            </small>
                        </div>
                    </div>
                    <div class="form-group col-lg-3">
                        <div class="fechaLimite">
                            <label for="forFechaLimite">Fecha Límite: </label>
                            <input class="form-control" type="date" id="fecha_limite" />
                        </div>
                        <div class="col-sm-12" id="error_fechaLimite">
                            <small id="fechaLimiteHelp" class="text-danger">
                                Por favor seleccione la fecha límite correspondiente
                            </small>
                        </div>
                    </div>

                    <div class="form-row col-lg-4 mt-2" id="prioridadEntregableBD">
                        <div class="form-group mt-2 col-md-12">
                            <label for="fechaCierre">Prioridad:</label><br>
                            <select class="form-control" id="prioridad_entregable">
                                <option value="">Seleccione la prioridad</option>
                                <option value="1">Normal</option>
                                <option value="2">Urgente</option>
                            </select>
                            <div class="col-sm-12" id="error_prioridad">
                                <small id="comentariosHelp" class="text-danger">
                                    Por favor seleccione la prioridad del entregable
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="form-row col-lg-12 mt-2" id="comentariosEntregableBD">
                        <div class="form-group mt-2 col-md-12">
                            <label for="fechaCierre">Comentarios:</label><br>
                            <textarea id="comentarios_entregableBD" class="form-control"></textarea>
                            <div class="col-sm-12" id="error_comentariosEntreBD">
                                <small id="comentariosHelp" class="text-danger">
                                    Por favor capture los comentarios correspondientes
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="adjuntarArchivo">Adjuntar Entregable</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para la captura de Entregables Bajo Demanda *@

@* Modal para la ver Adjuntos *@
<div class="modal fade" id="show_pdf">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white" id="titlePDF"></h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <tr>
                        <td><strong>Folio: </strong> @Model.Folio</td>
                        <td><strong>Año: </strong>@Model.Anio</td>
                        <td><strong>Mes: </strong>@Model.Mes</td>
                        <td><strong>Inmueble: </strong>@Model.inmuebles.Nombre</td>
                    </tr>
                    <tr>
                        <td><strong>Estatus: </strong>@Model.Estatus </td>
                    </tr>
                </table>
                <div class="row" id="objectPdf">
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@*Fin Modal para ver Adjuntos*@

@* Modal para agregar facturas la cedula *@
<div class="modal fade" id="modal-email">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header bg-joke">
                <h4 class="modal-title text-white">Actualizar Correo Electrónico</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row col-lg-12 mt-2">
                    <div class=" col-lg-12">
                        <label for="">Correo Electrónico:</label>
                        <input class="form-control" type="email" id="user_email" />
                    </div>
                </div>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" id="update_email">Actualizar Correo</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
@* FIN del Modal para agregar facturas la cedula *@

@section Scripts{
    <script>
        $(function () {
            var model = @Html.Raw(Json.Serialize(@Model));
            $('[data-toggle="tooltip"]').tooltip();
            /*Ocultamos las validaciones y el listado de entregables si no hay*/
                $('#listado_entregablesBD').css('display', 'none');
                document.getElementById("btn_entregableBD").style.display = "none";
                $('#error_prioridad').css('display', 'none');
                $('#error_fechaLimite').css('display', 'none');
                $('#error_fechaEntrega').css('display', 'none');
                $('#error_customFile').css('display', 'none');
                $('#error_comentariosEntreBD').css('display', 'none');
            /*Fin Ocultamos las validaciones y el listado de entregables si no hay*/

            /*Llenamos los entregables bajo demanda*/
            axios.get("/cedLimpieza/getEntregablesBD/" + model.id).then(lists => {
                    if (lists.data != "") {
                        $('#list_entregablesBD').html(lists.data);
                    }
                });
            /*Fin del llenado de entregables bajo demanda*/

            /*Ver archivo en modal*/
            $(document).on('click', '.view_file', function () {
                let nombre = $(this).data('file');
                let tipo = $(this).data('tipo');
                let data = "<object width='100%' height='450px' data='/cedLimpieza/verArchivo/" + model.folio + "/" + nombre+"'></object>";
                $('#titlePDF').text("PDF - \"" + tipo + "\"");
                $('#objectPdf').html(data);
                $('#show_pdf').modal('show');
            });
            /*FIN de ver archivo en modal*/

            /*Autorizar Cedula*/
            $(document).on('click', '.success_cedula', function () {
                if (model.usuarios.correo_electronico == "") {
                    Swal.fire({
                        'icon': 'error',
                        'title': 'Servicio de Limpieza y Áreas Comunes',
                        'text': 'No se puede "Aceptar" la cédula ya que aún no se registra un correo electrónico para notificarle al usuario.'
                    });
                } else {
                    Swal.fire({
                        'icon': 'warning',
                        'title': 'Servicio de Limpieza y Áreas Comunes',
                        'html': '¿Esta seguro de que desea <b>Aceptar la cédula con el folio: ' + model.folio + ' ?',
                        'confirmButtonColor': '#3085d6',
                        'cancelButtonColor': '#d33',
                        'confirmButtonText': 'Si, aceptar cédula',
                        'cancelButtonText': 'Cancelar',
                        'showCancelButton': true
                    }).then(confirm => {
                        if (confirm.isConfirmed) {
                            Swal.fire({
                                icon: 'info',
                                'title': 'Servicio de Limpieza y Áreas Comunes',
                                text: 'Por favor captura el motivo por el cual Autorizas la cédula.',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                cancelButtonText: 'Cancelar',
                                confirmButtonText: 'Autorizar',
                                input: 'text',
                                inputPlaceholder: 'Escribe los comentarios correspondientes'
                            }).then(send => {
                                if (send.value.length > 0) {
                                    axios.post('/cedLimpieza/historialLimpieza', {
                                        CedulaId: model.id, UsuarioId: parseInt(@User.Claims.ElementAt(0).Value),
                                        Estatus: "Autorizada", Comentarios: send.value
                                    }).then(hist => {
                                        if (hist.status == 200) {
                                            axios.post('/cedLimpieza/aprovRechCed', { Id: model.id, Estatus: "Autorizada" }).then(response => {
                                                if (response.status == 200) {
                                                    Swal.fire({
                                                        'icon': 'success',
                                                        'title': 'Servicio de Limpieza y Áreas Comunes',
                                                        'text': 'Se autorizó la cédula correctamente'
                                                    }).then(function () {
                                                        window.location.reload();
                                                    });
                                                }
                                            });
                                        }
                                    }).catch(er => {
                                        Swal.fire({
                                            'icon': 'error',
                                            'title': 'Servicio de Limpieza y Áreas Comunes',
                                            'text': 'Ocurrio un error al autorizar la cédula. Contacte al Administrador de Sistema.'
                                        });
                                    });
                                } else {
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': 'Servicio de Limpieza y Áreas Comunes',
                                        'text': 'Capture los comentarios solicitados indicando el motivo por el cual se autoriza la cédula.'
                                    });
                                }
                            });
                        }
                    });
                }
            });
            /*Fin de Autorizar Cedula*/

            /*Rechazar Cedula*/
            $(document).on('click', '.failed_cedula', function () {
                if (model.usuarios.correo_electronico == "") {
                    Swal.fire({
                        'icon': 'error',
                        'title': 'Servicio de Limpieza y Áreas Comunes',
                        'text': 'No se puede "Rechazar" la cédula ya que aún no se registra un correo electrónico para notificarle al usuario.'
                    })
                } else {
                    Swal.fire({
                        'icon': 'warning',
                        'title': 'Servicio de Limpieza y Áreas Comunes',
                        'html': '¿Estas seguro de que deseas <b>Rechazar la cédula con el folio: ' + model.folio + ' ?',
                        'confirmButtonColor': '#3085d6',
                        'cancelButtonColor': '#d33',
                        'confirmButtonText': 'Si, rechazar cédula',
                        'cancelButtonText': 'Cancelar',
                        'showCancelButton': true
                    }).then(confirm => {
                        if (confirm.isConfirmed) {
                            Swal.fire({
                                icon: 'info',
                                'title': 'Servicio de Limpieza y Áreas Comunes',
                                text: 'Por favor captura el motivo por el cual rechazas la cédula.',
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                cancelButtonText: 'Cancelar',
                                confirmButtonText: 'Rechazar',
                                input: 'text',
                                inputPlaceholder: 'Escribe los comentarios correspondientes'
                            }).then(send => {
                                if (send.value.length > 0) {
                                    axios.post('/cedLimpieza/historialLimpieza', {
                                        CedulaId: model.id, UsuarioId: parseInt(@User.Claims.ElementAt(0).Value),
                                        Estatus: "Rechazada", Comentarios: send.value
                                    }).then(hist => {
                                        if (hist.status == 200) {
                                            axios.post('/cedLimpieza/aprovRechCed', { Id: model.id, Estatus: "Rechazada" }).then(response => {
                                                if (response.status == 200) {
                                                    Swal.fire({
                                                        'icon': 'success',
                                                        'title': 'Cédula Rechazada',
                                                        'text': 'Se rechazó la cédula correctamente'
                                                    }).then(function () {
                                                        window.location.reload();
                                                    });
                                                }
                                            });
                                        }
                                    }).catch(er => {
                                        Swal.fire({
                                            'icon': 'error',
                                            'title': 'Servicio de Limpieza y Áreas Comunes',
                                            'text': 'Ocurrio un error al rechazar la cédula. Por favor comunicate a la ext. 2574.'
                                        });
                                    });
                                } else {
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': 'Servicio de Limpieza y Áreas Comunes',
                                        'text': 'Es necesario capturar los comentarios indicando el motivo por el cual se rechaza la cédula.'
                                    });
                                }
                            });
                        }
                    });
                }
            });
            /*Fin de Rechazar Cedula*/

             /*Ver Facturas*/
                $("#btn_facturas").click(function () {
                    axios.get('/limpieza/getFacturas/' + model.id+'/'+1).then(table => {
                        var facturas = table.data;
                        for (var i = 0; i < facturas.length; i++) {
                            table += "<tr>" +
                                "<td>" + (i + 1) + "</td>" +
                                "<td>" + facturas[i].emisor.nombre + "</td>" +
                                "<td>" + facturas[i].timbreFiscal.uuid + "</td>" +
                                "<td>" + (facturas[i].comprobante.serie + "" + facturas[i].comprobante.folio) + "</td>" +
                                "<td> $" + parseFloat(facturas[i].comprobante.subTotal).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + "</td>" +
                                "<td> $" + parseFloat(facturas[i].comprobante.total).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + "</td>" +
                                "<td>" +
                                    "<a class='view_factura' href='#' data-id='" + i + "'><i class='far fa-list text-success'></i></a>" +
                                "</td>" +
                                "</tr>";
                        }
                            $("#listaFacturas").html(table);
                        if (facturas.length == 0) {
                            $("#listado_facturas").hide();
                        } else {
                            $("#listado_facturas").show();
                        }
                    });
                    $('#modal-ver-facturas').modal('show');
                });

                    $(document).on('click','.view_factura',function () {
                        var id = $(this).data('id');
                        var divTbl = "";
                        $('#modal-ver-facturas').modal('hide');
                        axios.get('/limpieza/getFacturas/' + model.id + '/' + 1).then(table => {
                            $("#factura_serie").text("Detalle de la Factura: " + table.data[id].comprobante.serie + table.data[id].comprobante.folio);
                            var conceptos = table.data[id].concepto;

                            for (var i = 0; i < conceptos.length; i++) {
                                divTbl += '<div class="row col-lg-12 mt-1">' +
                                    '<table class="table table-borderless">' +
                                    '<tr>' +
                                        '<td colspan="4"><strong>Concepto: </strong>' + conceptos[i].descripcion + '</td>'+
                                    '</tr>'+
                                    '<tr>' +
                                    '    <td data-toggle="tooltip" title="Número de elementos que prestaron el servicio en el mes" data-placement="top" id="concepto_cantidad"><strong>Cantidad: </strong>' + table.data[id].concepto[i].cantidad + '</td>' +
                                    '    <td data-toggle="tooltip" title="Clave del Producto o Servicio Facturado" data-placement="top" id="concepto_cveProduc"><strong>Clave del Producto: </strong>' + table.data[id].concepto[i].claveProdServ + '</td>' +
                                    '    <td data-toggle="tooltip" title="Clave de la Medida en Base al Servicio" data-placement="top" id="concepto_medida"><strong>Clave de Medida: </strong>' + table.data[id].concepto[i].claveUnidad + '</td>' +
                                    '    <td data-toggle="tooltip" title="Unidad de Medida" data-placement="top" id="concepto_unidadMed"><strong>Unidad de Medida: </strong>' + table.data[id].concepto[i].unidad + '</td>' +
                                    '    <td data-toggle="tooltip" title="Tipo de CFDI" data-placement="top" id="tipo_cfdi"><strong>Uso de CFDI: </strong>' + table.data[id].receptor.usoCFDI + '</td>' +
                                    '    <td data-toggle="tooltip" title="Valor unitario por unidad" data-placement="top" id="concepto_unitario"><strong>Precio Unitario: </strong> $ ' + (table.data[id].concepto[i].valorUnitario).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</td>' +
                                    '</tr>' +
                                    '<tr>' +
                                    '    <td data-toggle="tooltip" title="IVA del subtotal del 16%" data-placement="top" id="concepto_iva"><strong>IVA: </strong> $ ' + (table.data[id].traslado.importe).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</td>' +
                                    '    <td data-toggle="tooltip" title="Importe total de la facturación" data-placement="top" id="concepto_total"><strong>Total: </strong> $ ' + (table.data[id].concepto[i].importe).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') + '</td>' +
                                    '    <td colspan="3"></td>' +
                                    '</tr>' +
                                    '</table>' +
                                    '</div>';
                            }
                            $("#detalle_conceptos").html(divTbl);
                            $('#modal-ver-conceptos').modal('show');
                        });
                   });
            /*Fin de Ver Facturas*/


            /************** Respuestas Adicionales Capacitacion***************/
                $('#btnCapacitacion').click(function () {
                var respuesta = $("input[name=preguntaCapacitacion]:checked").val();

                    if (respuesta == null) {
                    Swal.fire({
                        'icon': 'error',
                        'title': 'Error en Capacitación',
                        'html': 'Por favor seleccione si el personal esta debídamente capacitado.'
                    });
                    return false;
                }
                var penalizable = (respuesta == "true") ? false : true;

                    if (model.capacitacion.id == 0 || model.capacitacion.respuesta + "" != respuesta) {
                    axios.post('/limpieza/insertaCapacitacion', {
                        CedulaLimpiezaId: parseInt(model.id), Pregunta: "Capacitación", Respuesta: (respuesta == "true"), Penalizable: penalizable
                    }).then(response => {
                        Swal.fire({
                            'icon': 'success',
                            'title': 'Capacitación Agregada',
                            'html': 'Se guardó la respuesta de la capacitación del prestador de servicios.'
                        }).then(function () {
                            window.location.href = "/limpieza/revision/" + model.id;
                        });
                    }).catch(error => {
                        Swal.fire({
                            'icon': 'error',
                            'title': 'Error en Capacitación',
                            'html': 'Ocurrio un error al guardar la respuesta, favor de contactar al administrador del sistema.'
                        });
                    });
                } else {
                    Swal.fire({
                        'icon': 'info',
                        'title': 'Capacitación Limpieza',
                        'html': 'La respuesta seleccionada ya fue guardada.'
                    });
                }
            });

                if (model.capacitacion.id != 0) {
                    if (model.capacitacion.respuesta != true) {
                        $('#radioSuccess2').prop('checked', 'selected');
                    } else {
                        $('#radioSuccess1').prop('checked', 'selected');
                    }
                }
            /************** FIN Respuesta Adicionales Capacitacion***************/



            /************** Entregables Bajo Demanda ****************************/
                /*Si existe una respuesta de entregables bajo demanda*/
                    if (model.eAdicionales.length > 0) {
                        if (model.eAdicionales[0].archivo == null || model.eAdicionales[0].archivo == "") {
                            $('#radioSuccess3').prop('checked', 'selected');
                            $('#listado_entregablesBD').css('display', 'block');
                            document.getElementById("btn_entregableBD").style.display = "block";
                        }
                    } else {
                        $('#radioSuccess4').prop('checked', 'selected');
                    }
                /*Fin de si existe una respuesta de entregables bajo demanda*/

                /*Muestra el Modal para Adjuntar*/
                    $('#btn_entregableBD').click(function () {
                        $('#file_id').val(parseInt(''));
                        $(".custom-file-label").text('');
                        $('#fecha_entrega').val('');
                        $('#fecha_limite').val('');
                        $('#prioridad_entregable').val('');
                        $('#comentarios_entregableBD').val('');
                        $('#modal_entregablesBD').modal('show');
                    });
                /*Fin del modal para adjuntar*/

                /*Muestra/Oculta el listado de entregables Bajo demanda*/
                    $('.entregablesBajoD').change(function () {
                        let entregables = $(this).val();
                        if (entregables == "true") {
                            document.getElementById("btn_entregableBD").style.display = "block";
                            $('#listado_entregablesBD').css('display', 'block');
                        } else {
                            /*Validamos que no existan entregables bajo demanda*/
                                axios.get("/cedLimpieza/getEntregablesBD/" + model.id).then(lists => {
                                    if (lists.data != "") {
                                        /*Como si existen registros tenemos que avisar que se van a borrar*/
                                            Swal.fire({
                                                'icon': 'warning',
                                                'html': '<strong>Advertencia:</strong><p>Tienes entregables previamente capturados en esta pregunta, al cambiar la respuesta de "SI" a "NO" ' +
                                                    '<strong>se borrarán dichos entregables. ¿Deseas continuar? </strong></p>',
                                                'confirmButtonColor': '#3085d6',
                                                'cancelButtonColor': '#d33',
                                                'confirmButtonText': 'Si, deseo continuar',
                                                'cancelButtonText': 'Cancelar',
                                                'showCancelButton': true
                                            }).then(erase => {
                                                if (erase.isConfirmed) {
                                                    Swal.fire({
                                                        'icon': 'warning',
                                                        'title': 'Confirmación del cambio de respuesta',
                                                        'text': 'Escriba la palabra BORRAR para confirmar el cambio de respuesta.',
                                                        'confirmButtonColor': '#3085d6',
                                                        'cancelButtonColor': '#d33',
                                                        'confirmButtonText': 'Si, eliminar todo',
                                                        'cancelButtonText': 'Cancelar',
                                                        'showCancelButton': true,
                                                        'input': 'text',
                                                        'inputPlaceholder': 'Escribe la palabra BORRAR'
                                                    }).then(res => {
                                                        if (res.value == 'BORRAR') {
                                                            axios.post('/cedLimpieza/eliminaTodoEntregableBD', { Id: model.id, Folio: model.folio }).then(r => {
                                                                Swal.fire({
                                                                    'icon': 'success',
                                                                    'title': 'Borrado finalizado',
                                                                    'text': 'Los archivos de "Entregables Bajo Demanda" previamente capturados fueron eliminados exitósamente.',
                                                                }).then(function () {
                                                                    $('input:radio[name="entregablesBajoD"][value="false"]').prop('checked', true);
                                                                    document.getElementById("btn_entregableBD").style.display = "none";
                                                                    $('#listado_entregablesBD').css('display', 'none');
                                                                });
                                                            });

                                                            axios.get("/cedLimpieza/getEntregablesBD/" + model.id).then(lists => {
                                                                $('#list_entregablesBD').html(lists.data);
                                                            });

                                                        } else {
                                                            Swal.fire({
                                                                'icon': 'error',
                                                                'title': 'Error de escritura',
                                                                'text': 'Debes escribir correctamente la palabra BORRAR.',
                                                            });
                                                            document.getElementById("btn_entregableBD").style.display = "block";
                                                            $('#listado_entregablesBD').css('display', 'block');
                                                            $('input:radio[name="pregunta2"][value="false"]').prop('checked', true);
                                                        }
                                                    });
                                                } else {
                                                    $('input:radio[name="entregablesBajoD"][value="true"]').prop('checked', true);
                                                    document.getElementById("btn_entregableBD").style.display = "block";
                                                    $('#listado_entregablesBD').css('display', 'block');
                                                }
                                            });
                                        /*FIn si existen registros tenemos que avisar que se van a borrar*/
                                    }
                                });
                            /*FIn de la Validacion que no existan entregables bajo demanda*/
                            document.getElementById("btn_entregableBD").style.display = "none";
                            $('#listado_entregablesBD').css('display', 'none');
                        }
                    });
                /*FIN Muestra/Oculta el listado de entregables Bajo demanda*/

                /*Guarda la Respuesta*/
                    $('#btnEntregables').click(function () {
                        var respuesta = $("input[name=entregablesBajoD]:checked").val();

                        if (respuesta == null) {
                            Swal.fire({
                                'icon': 'error',
                                'title': 'Error "Entregables Bajo Demanda"',
                                'html': 'Por favor seleccione si el hubo algún entregable bajo demanda.'
                            });
                            return false;
                        }

                        if (respuesta == "true") {
                            axios.get('/cedLimpieza/getEntregablesBD/' + model.id).then(response => {
                                if (response.data == "") {

                                //} else {
                                    Swal.fire({
                                        'icon': 'error',
                                        'title': 'Error "Entregables Bajo Demanda"',
                                        'html': 'Por favor adjunta por lo menos 1 archivo para continuar.'
                                    });
                                }
                            });
                        } else if(respuesta == "false"){

                        }

                    });
                /*Fin de guardar la respuesta*/

                /*Guarda Entregable Bajo Demanda*/
                    function validaCamposArchivo() {
                        if ($('#fecha_limite').val() == "" && $('#fecha_entrega').val() == "" && $('#customFile').val() == "" && $('#prioridad_entregable').val() == "") {
                            $('#customFile').addClass('is-invalid');
                            $('#error_customFile').css('display', 'block');

                            $('#fecha_limite').addClass('is-invalid');
                            $('#error_fechaLimite').css('display', 'block');

                            $('#fecha_entrega').addClass('is-invalid');
                            $('#error_fechaEntrega').css('display', 'block');

                            $('#prioridad_entregable').addClass('is-invalid');
                            $('#error_prioridad').css('display', 'block');

                            return false;
                        }

                        if ($('#fecha_limite').val() == "" && $('#fecha_entrega').val() == "") {
                            $('#fecha_limite').addClass('is-invalid');
                            $('#error_fechaLimite').css('display', 'block');

                            $('#fecha_entrega').addClass('is-invalid');
                            $('#error_fechaEntrega').css('display', 'block');

                            return false;
                        }

                        if ($('#customFile').val() == "" && $('#fecha_entrega').val() == "") {
                            $('#customFile').addClass('is-invalid');
                            $('#error_customFile').css('display', 'block');

                            $('#fecha_entrega').addClass('is-invalid');
                            $('#error_fechaEntrega').css('display', 'block');

                            return false;
                        }

                        if ($('#fecha_limite').val() == "" && $('#customFile').val() == "") {
                            $('#fecha_limite').addClass('is-invalid');
                            $('#error_fechaLimite').css('display', 'block');

                            $('#customFile').addClass('is-invalid');
                            $('#error_customFile').css('display', 'block');

                            return false;
                        }

                        if ($('#fecha_entrega').val() == "") {
                            $('#fecha_entrega').addClass('is-invalid');
                            $('#error_fechaEntrega').css('display', 'block');

                            return false;
                        }

                        if ($('#fecha_limite').val() == "") {
                            $('#fecha_limite').addClass('is-invalid');
                            $('#error_fechaLimite').css('display', 'block');

                            return false;
                        }

                        if ($('#customFile').val() == "") {

                            $('#customFile').addClass('is-invalid');
                            $('#error_customFile').css('display', 'block');

                            return false;
                        }

                        if ($('#prioridad_entregable').val() == "") {
                            $('#prioridad_entregable').addClass('is-invalid');
                            $('#error_prioridad').css('display', 'block');
                            return false;
                        }

                        return true;
                    }

                    $("#customFile").on("change", function () {
                        var fileName = $(this).val().split("\\").pop();
                        var ext = fileName.split('.').pop();
                        if (ext == "pdf") {
                            $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                        } else {
                            Swal.fire({
                                'icon': 'error',
                                'title': 'Formato Incorrecto',
                                'text': 'El archivo que intentas adjuntar no es válido. Favor de solo seleccionar archivos "PDF"'
                            });
                            $(".custom-file-label").text("Seleccionar Archivo");
                            document.getElementById('customFile').value = '';
                            if ($('#customFile').hasClass('is-valid')) {
                                $('#customFile').removeClass('is-valid');
                            }
                            $('#customFile').addClass('is-invalid');
                            $('#error_customFile').css('display', 'block');
                        }

                    });

                    $('#adjuntarArchivo').click(function () {
                        var formData = new FormData();
                        var respuesta = $("input[name=entregablesBajoD]:checked").val();
                        var file = document.getElementById('customFile').files[0];
                        var id = $('#file_id').val();
                        var comentarios = $('#comentarios_entregableBD').val();
                        var fechaLimite = $('#fecha_limite').val();
                        var fechaEntrega = $('#fecha_entrega').val();
                        var prioridad = $('#prioridad_entregable').val();
                        var penalizable = 0;

                        if (id.length > 0) {
                            id = parseInt(id);
                        } else {
                            id = 0;
                        }

                        if (fechaEntrega > fechaLimite) {
                            penalizable = true;
                        }



                        formData.append("Id", id);
                        formData.append("CedulaLimpiezaId", model.id);
                        formData.append("Archivo", file);
                        formData.append("Folio", model.folio);
                        formData.append("Prioridad", prioridad);
                        formData.append("Comentarios", comentarios);
                        formData.append("Respuesta", respuesta);
                        formData.append("FechaEntrega", fechaEntrega);
                        formData.append("FechaLimite", fechaLimite);
                        formData.append("Penalizable", penalizable);

                        if (validaCamposArchivo()) {
                            axios.post('/cedLimpieza/adjuntaEntregableBD', formData, {
                                headers: { 'Content-Type': 'multipart/form-data' }
                            }).then(response => {
                                /*Validamos la pregunta a la que se realizo el anexo de evidencia*/
                                if (response.status == 200) {
                                    Swal.fire({
                                        'icon': "success",
                                        'title': 'Adjuntar Archivo',
                                        'text': 'Se adjuntó el archivo de forma correcta.'
                                    });

                                    axios.get("/cedLimpieza/getEntregablesBD/" + model.id).then(lists => {
                                        if (lists.data != "") {
                                            $('#list_entregablesBD').html(lists.data);
                                        }
                                    });

                                    $('#customFile').removeClass('is-valid');
                                    $('#comentarios_entregableBD').removeClass('is-valid');
                                    $('#fecha_limite').removeClass('is-valid');
                                    $('#fecha_entrega').removeClass('is-valid');
                                    $('#prioridad_entregable').removeClass('is-valid');

                                    $('#file_id').val("");
                                    $('#prioridad_entregable').val("");
                                    $(".custom-file-label").text("Seleccionar Archivo");
                                    $('#fecha_limite').val('');
                                    $('#fecha_entrega').val('');
                                    $('#comentarios_entregableBD').val('');

                                }
                            });
                        }

                    });

                    $('#fecha_limite').change(function () {
                         if ($('#fecha_limite').val() == "") {
                             $('#fecha_limite').addClass('is-invalid');
                             $('#error_fechaLimite').css('display', 'block');
                         } else {
                             $('#fecha_limite').removeClass('is-invalid');
                             $('#fecha_limite').addClass('is-valid');
                             $('#error_fechaLimite').css('display', 'none');
                         }
                    });

                    $('#fecha_entrega').change(function () {
                         if ($('#fecha_entrega').val() == "") {
                             $('#fecha_entrega').addClass('is-invalid');
                             $('#error_fechaEntrega').css('display', 'block');
                         } else {
                             $('#fecha_entrega').removeClass('is-invalid');
                             $('#fecha_entrega').addClass('is-valid');
                             $('#error_fechaEntrega').css('display', 'none');
                         }
                    });

                    $('#customFile').change(function () {
                         if ($('#customFile').val() == "") {
                             $('#customFile').addClass('is-invalid');
                             $('#error_customFile').css('display', 'block');

                        } else {
                             var fileName = $("#customFile").val().split("\\").pop();
                             var ext = fileName.split('.').pop();
                             if (ext != "pdf") {
                                 $('#customFile').addClass('is-invalid');
                                 $('#error_customFile').css('display', 'block');
                             } else {
                                 $('#customFile').removeClass('is-invalid');
                                 $('#customFile').addClass('is-valid');
                                 $('#error_customFile').css('display', 'none');
                             }
                        }
                    });

                    $('#prioridad_entregable').change(function(){
                        if ($('#prioridad_entregable').val() == "") {
                            $('#prioridad_entregable').addClass('is-invalid');
                            $('#error_prioridad').css('display', 'block');
                        } else {
                            $('#prioridad_entregable').removeClass('is-invalid');
                            $('#prioridad_entregable').addClass('is-valid');
                            $('#error_prioridad').css('display', 'none');
                        }
                    });
                /*Fin de Guardar entregable Bajo Demanda*/

                 /*Editar Entregables*/
                    $(document).on("click", ".update_files", function () {
                        var id = $(this).data('id');
                        var fechaEntrega = $(this).data('entrega');
                        var fechaLimite = $(this).data('limite');
                        var coments = $(this).data('coments');
                        var prioridad = $(this).data('prioridad');
                        var file = $(this).data('file');

                        $('#file_id').val(parseInt(id));
                        $(".custom-file-label").text(file);
                        $('#fecha_entrega').val(fechaEntrega);
                        $('#fecha_limite').val(fechaLimite);
                        $('#prioridad_entregable').val(prioridad);
                        $('#comentarios_entregableBD').val(coments);
                        $('#modal_entregablesBD').modal('show');
                    });
                /*FIN de editar Entregables*/

                /*Elimina entregables*/
                    $(document).on("click", ".delete_files", function () {
                        let id = $(this).data('id');

                        Swal.fire({
                            'icon': 'warning',
                            'title': '¿Deseas Continuar?',
                            'text': '¿Estás seguro de eliminar el entregable ?',
                            'confirmButtonColor': '#3085d6',
                            'cancelButtonColor': '#d33',
                            'confirmButtonText': 'Si, Eliminar Archivo',
                            'cancelButtonText': 'Cancelar',
                            'showCancelButton': true
                        }).then(response => {
                            if (response.isConfirmed) {
                                axios.post("/cedLimpieza/eliminaEntregableBD", { Id: id, Folio: model.folio }).then(response => {
                                    if (response.status == 200) {
                                        Swal.fire(
                                            'Archivo Borrado',
                                            'Tu archivo fue eliminado con éxito.',
                                            'success'
                                        );
                                        axios.get("/cedLimpieza/getEntregablesBD/" + model.id).then(lists => {
                                            if (lists.data != "") {
                                                $('#list_entregablesBD').html(lists.data);
                                            }
                                        });
                                    }
                                }).catch(error => {
                                    Swal.fire(
                                        'Algo Falló',
                                        'No se pudo procesar tu solicitud. Contacta a tu Administrador.',
                                        'error'
                                    );
                                });
                            }
                        });
                    });
                /*FIN de elimina entregables*/

            /************** Fin de Entregables Bajo Demanda *********************/

            /************** Actualizar Correo Electrónico **********************/
            $("#btn_correo").click(function () {
                    var email = model.usuarios.correo_electronico;
                    $("#user_email").val(email);
                    $("#modal-email").modal("show");
                });

                $("#update_email").click(function () {
                    var email = $("#user_email").val();
                    var user = model.usuarios.id;

                    if(email.indexOf('@String.Format("@")', 0) == -1 || email.indexOf('.', 0) == -1) {
                        Swal.fire({
                            'icon': 'warning',
                            'title': 'Actualización de Correo Electrónico',
                            'html': 'El correo electrónico capturado no es válido. Favor de revisar.'
                        });
                        return false;
                    }

                    axios.post('/usuarios/actualizaEmail', { Id: user, correo_electronico: email }).then(res => {
                        Swal.fire({
                            'icon': 'success',
                            'title': 'Actualización de Correo Electrónico',
                            'html': 'Se actualizó la dirección de correo electrónico del usuario.'
                        }).then(function () {
                            window.location.reload();
                        });
                    });

                });
            /************ Fin Actualizar Correo Electrónico ********************/

        });
    </script>
}


