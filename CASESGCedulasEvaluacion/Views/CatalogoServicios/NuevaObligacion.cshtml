@model CedulasEvaluacion.Entities.MContratos.EntregablesContrato;

@{
    ViewData["title"] = "Nueva Oblicación para el Contrato \"" + @Model.contrato.NumeroContrato + "\"";
}
<div class="container-fluid" id="obligacion">
    <form method="post" asp-controller="EntregablesContrato" asp-action="insertaObligacion" enctype = "multipart/form-data">
        <div class="card">
            <div class="card-header bg-joke text-white">
                <h5 class="mt-2">Datos de Obligación</h5>
            </div>
            <div class="card-body">
                <div class="row col-lg-12">
                    <div class="col-lg-5">
                        <label for="">Descripcion:</label>
                        <input class="form-control" type="text" id="descripcion" asp-for="@Model.Descripcion" />
                        <div class="col-sm-12 error_descripcion">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione la descripción de la obligacion
                            </small>
                        </div>
                    </div>
                    <div class=" col-lg-4">
                        <label for="">Obligacion:</label>
                        <select class="form-control" id="tipoObligacion" asp-for="@Model.Tipo">
                            <option value="">Seleccione una opción</option>
                            <option value="Garantía">Garantías</option>
                            <option value="Programa de Operación">Programa de Operación</option>
                            <option value="Fianza de Cumplimiento">Fianza de Cumplimiento</option>
                            <option value="Póliza de Responsabilidad">Póliza de Responsabilidad</option>
                            <option value="Fianza de Obligaciones Obrero-Patronales">Fianza de Obligaciones Obrero-Patronales</option>
                        </select>
                        <div class="col-sm-12 error_tipoObligacion">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el tipo de obligacion a entregar
                            </small>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <label for="">Tipo de Contrato:</label>
                        <select class="form-control" id="tipoContrato" asp-for="@Model.TipoContrato">
                            <option value="">Seleccione una opción</option>
                            <option value="Anual">Anual</option>
                            <option value="Plurianual">Plurianual</option>
                            <option value="N/A">N/A</option>
                        </select>
                        <div class="col-sm-12 error_tipoContrato">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el tipo de contrato
                            </small>
                        </div>
                    </div>
                </div>
                <div class="row col-lg-12 mt-4">
                    <div class=" col-lg-3">
                        <label for="">Inicio del Periodo:</label>
                        <input class="form-control" type="date" id="inicioPeriodo" asp-for="@Model.InicioPeriodo" />
                        <div class="col-sm-12 error_inicioPeriodo">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el inicio del periodo
                            </small>
                        </div>
                    </div>
                    <div class=" col-lg-3">
                        <label for="">Fin del Periodo:</label>
                        <input class="form-control" type="date" id="finPeriodo" asp-for="@Model.FinPeriodo" />
                        <div class="col-sm-12 error_finPeriodo">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione el fin del periodo
                            </small>
                        </div>
                    </div>
                    <div class=" col-lg-3">
                        <label for="">Fecha Programada:</label>
                        <input class="form-control" type="date" id="fechaProgramada" asp-for="@Model.FechaProgramada" />
                        <div class="col-sm-12 error_fechaProgramada">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione la fecha programada
                            </small>
                        </div>
                    </div>
                    <div class=" col-lg-3">
                        <label for="">Fecha de Entrega:</label>
                        <input class="form-control" type="date" id="fechaEntrega" asp-for="@Model.FechaEntrega" />
                        <div class="col-sm-12 error_fechaEntrega">
                            <small id="dateHelp" class="text-danger">
                                Por favor seleccione la fecha de entrega
                            </small>
                        </div>
                    </div>
                </div>
                <div class="row col-lg-12 mt-4">
                    <input class="form-control" id="idFactura" type="hidden" />
                    <div class="row col-lg-12 mt-2">
                        <div class="form-group col-lg-6">
                            <label for="elegirArchivo">Seleccionar Archivo: </label>
                            <div class="custom-file">
                                <input type="file" class="custom-file-input file_factura" id="fileFactura" accept=".pdf" asp-for="@Model.Archivo">
                                <label class="custom-file-label" for="customFile">Subir el archivo en formato "PDF"</label>
                            </div>
                            <div class="col-sm-12 error_customFile">
                                <small id="dateHelp" class="text-danger">
                                    Por favor seleccione él archivo correspondiente
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <div class=" col-lg-12">
                    <a href="/catalogo/detalleContrato/@Model.ContratoId" class="btn btn-danger float-right ml-2">Cancelar</a>
                    <button type="submit" class="btn btn-success float-right" id="guardarObligacion">Guardar Obligación</button>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts{
    <script>
        $(function () {
            $(".error_descripcion").css('display', 'none');
            $(".error_tipoObligacion").css('display', 'none');
            $(".error_tipoContrato").css('display', 'none');
            $(".error_inicioPeriodo").css('display', 'none');
            $(".error_finPeriodo").css('display', 'none');
            $(".error_fechaProgramada").css('display', 'none');
            $(".error_fechaEntrega").css('display', 'none');
            $(".error_customFile").css('display', 'none');

            $("#customFile").on("change", function () {
                var fileName = $(this).val().split("\\").pop();
                var ext = fileName.split('.').pop();
                if (ext == "pdf") {
                    $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                } else {
                    Swal.fire({
                        'icon': 'error',
                        'title': 'Obligaciones del PS',
                        'text': 'El archivo que intentas adjuntar no es válido. Favor de solo seleccionar archivos "PDF"'
                    });
                    $(".custom-file-label").text("Seleccionar Archivo");
                    document.getElementById('customFile').value = '';
                    if ($('#customFile').hasClass('is-valid')) {
                        $('#customFile').removeClass('is-valid');
                    }
                    $('#customFile').addClass('is-invalid');
                    $('#error_customFile').css('display', 'block');
                }

            });

            $("#guardarObligacion").click(function () {
                var descripcion = $("#descripcion").val();
                var tipoObligacion = $("#tipoObligacion").val();
                var tipoContrato = $("#tipoContrato").val();
                var inicioPeriodo = $("#inicioPeriodo").val();
                var finPeriodo = $("#finPeriodo").val();
                var fechaProgramada = $("#fechaProgramada").val();
                var fechaEntrega = $("#fechaEntrega").val();
                var customFile = $("#customFile").val();
                if (descripcion != "" && tipoObligacion != "" && tipoContrato != "" && inicioPeriodo != "" && finPeriodo != "" && fechaProgramada != ""
                    && fechaEntrega != "" && customFile != "") {
                    return true;
                }

                return false;
            });
        });
    </script>
}